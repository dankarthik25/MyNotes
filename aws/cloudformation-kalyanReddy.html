<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2023-03-16 Thu 11:44 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CloudFormation-Udemy</title>
<meta name="author" content="DeepAlgorithms" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="icon" type="image/png" href="https://deepalgorithms.in/assets/icons/favicon.png">
<link rel="stylesheet" type="text/css" href="readtheorg-htmlize.css"/>
<link rel="stylesheet" type="text/css" href="readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
<link rel="icon" type="image/png" href="https://deepalgorithms.in/images/favicon.png">
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">CloudFormation-Udemy</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgbabe16a">Cloud Formation Template</a></li>
<li><a href="#org558003d">Stack Concept with EC2 instnce Example</a>
<ul>
<li><a href="#orgad4d540">Create EC2 instance</a></li>
<li><a href="#org01a4875">Update Key</a></li>
<li><a href="#org8fa246f">Change Key</a></li>
<li><a href="#org76b6d12">Update Rollback</a></li>
<li><a href="#org9726b35">Invalid Template</a></li>
</ul>
</li>
<li><a href="#org021c651">Run Stack from Console</a></li>
<li><a href="#org1c775b2"><span class="todo TODO">TODO</span> Run Stack from awscli</a></li>
<li><a href="#org14e2e17">Resources with EC2-instance Example</a>
<ul>
<li><a href="#orgb16e899">Crearte EC2 instance</a></li>
<li><a href="#orgba03eb0">add new security group</a></li>
<li><a href="#org1000ebf">add new rule</a></li>
<li><a href="#org0dace89">Add Elastic IP</a></li>
<li><a href="#org17f0c0c">Test or Check CaseSensitive</a></li>
</ul>
</li>
<li><a href="#org5097085">Parameter Types</a>
<ul>
<li><a href="#org4e97a4b">Paramter Type : KeyName</a></li>
<li><a href="#org6d0d8da">Parameter Type: String</a></li>
<li><a href="#org82cbcd3">Parameter Type: InstanceType</a></li>
<li><a href="#orgd0279af">Parameter Type: SSM</a></li>
</ul>
</li>
<li><a href="#org10735e1">Mapping with Example</a>
<ul>
<li><a href="#org8552cad">Base Stack</a></li>
<li><a href="#org9f08631">Mapping AMI</a></li>
<li><a href="#orgac511dc">Mapping AMI with Environment</a></li>
</ul>
</li>
<li><a href="#org4e9eab5">Condition</a>
<ul>
<li><a href="#org394cde5">Syntax</a></li>
<li><a href="#org2031543">Condtion Intrinsic Function</a></li>
<li><a href="#orgd365e69">Base</a></li>
<li><a href="#org34eff2d">InstrinsicFunction-Fn-Equals</a></li>
<li><a href="#orge1b4183">if PseudoParameter-NoValue</a></li>
<li><a href="#orgdbf1bf1">Fn-if</a></li>
<li><a href="#orgd7c12b1">Fn-Not</a></li>
<li><a href="#org51f5dc9">Fn-Or</a></li>
<li><a href="#org16c2136">Fn-And</a></li>
</ul>
</li>
<li><a href="#org89e6014">Output</a>
<ul>
<li>
<ul>
<li><a href="#org4baf166">Base</a></li>
<li><a href="#org04c68c7">InstanceID</a></li>
<li><a href="#orgf290e4e">Instrinsic Fn::GetAtt</a></li>
<li><a href="#org659e2b3">Export Intrinsic Fn::Sub Pseudo StakName</a></li>
<li><a href="#org38b5537">Cross Refeence Intrinsic Fn::ImportValue</a></li>
<li><a href="#org06d821a">Output Conditions</a></li>
<li><a href="#org376b481">Output Export Intrinsic Fn:Join</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgca92c11">MetaData</a>
<ul>
<li>
<ul>
<li><a href="#org4996616">Base</a></li>
<li><a href="#org340ec3d">Metadata Interface</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org902536e">EC2 UserData</a>
<ul>
<li>
<ul>
<li><a href="#orgc134152">Base</a></li>
<li><a href="#org4b69ec9">shell script</a></li>
<li><a href="#orga7d8ca5">UserData</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgb1f6892">CFN-init</a></li>
<li><a href="#org9005c15">Configsets</a></li>
<li><a href="#orgc8b17ee">NestedStacks</a>
<ul>
<li>
<ul>
<li><a href="#org987972e">NestedStack VPC</a></li>
<li><a href="#org147daed">Root Stack EC2-VPC</a></li>
<li><a href="#orgef3742e">NestedStack-SG</a></li>
<li><a href="#org25e7ee3">RootStack -ECE-SG</a></li>
</ul>
</li>
<li><a href="#org9c56ba8">Manual Steps to Create VPC</a></li>
</ul>
</li>
<li><a href="#org439497f">Continous Delivery</a></li>
<li><a href="#orgeb4abe4">Infrasturcture As Code</a></li>
<li><a href="#org5a379bd">StackPolicy</a></li>
<li><a href="#orgd1cf8f4">Additional Templates</a></li>
</ul>
</div>
</div>
<p>
arn : Amazon Resouces Number : which is fixed/unique inside a account
</p>

<div id="outline-container-orgbabe16a" class="outline-2">
<h2 id="orgbabe16a">Cloud Formation Template</h2>
<div class="outline-text-2" id="text-orgbabe16a">
<p>
Templates componets 
</p>
<ul class="org-ul">
<li><b>Resources :</b> Your AWS resources declared in the template (MANDATORY)</li>
<li><b>Paramters :</b> Dynamic inputs for your tempalate</li>
<li><b>Mappings :</b> Static varaibles for your template</li>
<li><b>Outputs :</b> Reference to what has been created</li>
<li><b>Conditionals :</b> List of conditions to perform resource creation</li>
<li><b>Metadata :</b></li>
<li><b>Helpers</b>:
<ul class="org-ul">
<li><b>References</b> :</li>
<li><b>Functions</b> :</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-org558003d" class="outline-2">
<h2 id="org558003d">Stack Concept with EC2 instnce Example</h2>
<div class="outline-text-2" id="text-org558003d">
</div>
<div id="outline-container-orgad4d540" class="outline-3">
<h3 id="orgad4d540">Create EC2 instance</h3>
<div class="outline-text-3" id="text-orgad4d540">
<div class="org-src-container">
<pre class="src src-yaml">AWSTemplateFormatVersion: 2010-09-09
Resources: 
  DevEC2Instance: 
    Type: 'AWS::EC2::Instance'
    Properties: 
      ImageId: ami-0cd3dfa4e37921605
      InstanceType: t2.micro
</pre>
</div>
</div>
</div>
<div id="outline-container-org01a4875" class="outline-3">
<h3 id="org01a4875">Update Key</h3>
<div class="outline-text-3" id="text-org01a4875">
<div class="org-src-container">
<pre class="src src-yaml">AWSTemplateFormatVersion: 2010-09-09
Resources: 
  DevEC2Instance: 
    Type: 'AWS::EC2::Instance'
    Properties: 
      ImageId: ami-0cd3dfa4e37921605
      InstanceType: t2.micro
      KeyName: cfn-key-1
</pre>
</div>
</div>
</div>
<div id="outline-container-org8fa246f" class="outline-3">
<h3 id="org8fa246f">Change Key</h3>
<div class="outline-text-3" id="text-org8fa246f">
<div class="org-src-container">
<pre class="src src-yaml">AWSTemplateFormatVersion: 2010-09-09
Resources: 
  DevEC2Instance: 
    Type: 'AWS::EC2::Instance'
    Properties: 
      ImageId: ami-0cd3dfa4e37921605
      InstanceType: t2.micro
      KeyName: cfn-key-2
</pre>
</div>

<div class="org-src-container">
<pre class="src src-yaml">AWSTemplateFormatVersion: 2010-09-09
Resources: 
  DevEC2Instance: 
    Type: 'AWS::EC2::Instance'
    Properties: 
      ImageId: ami-0cd3dfa4e37921605
      InstanceType: t2.small
      KeyName: cfn-key-2
</pre>
</div>
</div>
</div>

<div id="outline-container-org76b6d12" class="outline-3">
<h3 id="org76b6d12">Update Rollback</h3>
<div class="outline-text-3" id="text-org76b6d12">
<div class="org-src-container">
<pre class="src src-yaml">AWSTemplateFormatVersion: 2010-09-09
Resources: 
  DevEC2Instance: 
    Type: 'AWS::EC2::Instance'
    Properties: 
      ImageId: ami-0cd3dfa4e37921605
      InstanceType: t2.small
      KeyName: cfn-key-3
</pre>
</div>
</div>
</div>
<div id="outline-container-org9726b35" class="outline-3">
<h3 id="org9726b35">Invalid Template</h3>
<div class="outline-text-3" id="text-org9726b35">
<div class="org-src-container">
<pre class="src src-yaml">AWSTemplateFormatVersion: 2010-09-09
Resources: 
  DevEC2Instance: 
    Type: 'AWS::EC2::Instance'
    Properties: 
      ImageId: ami-0cd3dfa4e37921605
      InstanceType: t2.small
      KeyName: cfn-key-3
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org021c651" class="outline-2">
<h2 id="org021c651">Run Stack from Console</h2>
</div>
<div id="outline-container-org1c775b2" class="outline-2">
<h2 id="org1c775b2"><span class="todo TODO">TODO</span> Run Stack from awscli</h2>
</div>
<div id="outline-container-org14e2e17" class="outline-2">
<h2 id="org14e2e17">Resources with EC2-instance Example</h2>
<div class="outline-text-2" id="text-org14e2e17">
</div>
<div id="outline-container-orgb16e899" class="outline-3">
<h3 id="orgb16e899">Crearte EC2 instance</h3>
<div class="outline-text-3" id="text-orgb16e899">
<div class="org-src-container">
<pre class="src src-yaml">AWSTemplateFormatVersion: 2010-09-09
Description: Basic EC2 Instance.

Resources:
  DevEC2Instance:
    Type: AWS::EC2::Instance
    Properties:
      ImageId: ami-0cd3dfa4e37921605
      InstanceType: t2.micro
      KeyName: cfn-key-1
      SecurityGroups:
	- default
</pre>
</div>
</div>
</div>
<div id="outline-container-orgba03eb0" class="outline-3">
<h3 id="orgba03eb0">add new security group</h3>
<div class="outline-text-3" id="text-orgba03eb0">
<div class="org-src-container">
<pre class="src src-yaml">AWSTemplateFormatVersion: 2010-09-09
Description: Basic EC2 Instance.

Resources:
  DevEC2Instance:
    Type: AWS::EC2::Instance
    Properties:
      ImageId: ami-0cd3dfa4e37921605
      InstanceType: t2.micro
      KeyName: cfn-key-1
      SecurityGroups:
	- default
	- !Ref SSHSecurityGroup
  SSHSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: my new SSH SG
      SecurityGroupIngress:
	- IpProtocol: tcp
	  FromPort: '22'
	  ToPort: '22'
	  CidrIp: 0.0.0.0/0
</pre>
</div>
</div>
</div>
<div id="outline-container-org1000ebf" class="outline-3">
<h3 id="org1000ebf">add new rule</h3>
<div class="outline-text-3" id="text-org1000ebf">
<div class="org-src-container">
<pre class="src src-yaml">AWSTemplateFormatVersion: 2010-09-09
Description: Basic EC2 Instance.

Resources:
  DevEC2Instance:
    Type: AWS::EC2::Instance
    Properties:
      ImageId: ami-0cd3dfa4e37921605
      InstanceType: t2.micro
      KeyName: cfn-key-1
      SecurityGroups:
	- default
	- !Ref SSHSecurityGroup
  SSHSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: my new SSH SG
      SecurityGroupIngress:
	- IpProtocol: tcp
	  FromPort: '22'
	  ToPort: '22'
	  CidrIp: 0.0.0.0/0
	- IpProtocol: tcp
	  FromPort: '8080'
	  ToPort: '8080'
	  CidrIp: 0.0.0.0/0

</pre>
</div>
</div>
</div>
<div id="outline-container-org0dace89" class="outline-3">
<h3 id="org0dace89">Add Elastic IP</h3>
<div class="outline-text-3" id="text-org0dace89">
<div class="org-src-container">
<pre class="src src-yaml">AWSTemplateFormatVersion: 2010-09-09
Description: Basic EC2 Instance.

Resources:
  DevEC2Instance:
    Type: AWS::EC2::Instance
    Properties:
      ImageId: ami-0cd3dfa4e37921605
      InstanceType: t2.micro
      KeyName: cfn-key-1
      SecurityGroups:
	- default
	- !Ref SSHSecurityGroup
  SSHSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: my new SSH SG
      SecurityGroupIngress:
	- IpProtocol: tcp
	  FromPort: '22'
	  ToPort: '22'
	  CidrIp: 0.0.0.0/0
	- IpProtocol: tcp
	  FromPort: '8080'
	  ToPort: '8080'
	  CidrIp: 0.0.0.0/0

  MyElasticIP:
    Type: AWS::EC2::EIP
    Properties:
      InstanceId: !Ref DevEC2Instance           
</pre>
</div>

<p>
#+end<sub>src</sub>
</p>
</div>
</div>

<div id="outline-container-org17f0c0c" class="outline-3">
<h3 id="org17f0c0c">Test or Check CaseSensitive</h3>
<div class="outline-text-3" id="text-org17f0c0c">
<div class="org-src-container">
<pre class="src src-yaml">AWSTemplateFormatVersion: 2010-09-09
Description: Basic EC2 Instance.

Resources:
  DevEC2Instance:
    Type: AWS::EC2::Instance
    Properties:
      ImageId: ami-0cd3dfa4e37921605
      InstanceType: t2.micro
      KeyName: cfn-key-1
      SecurityGroups:
	- default
	- !Ref SSHSecurityGroup
  SSHSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: my new SSH SG
      SecurityGroupIngress:
	- IpProtocol: tcp
	  FromPort: '22'
	  ToPort: '22'
	  CidrIp: 0.0.0.0/0
	- IpProtocol: tcp
	  FromPort: '8080'
	  ToPort: '8080'
	  CidrIp: 0.0.0.0/0
	- IpProtocol: tcp
	  FromPort: '8081'
	  ToPort: '8081'
	  CidrIP: 0.0.0.0/0          

  MyElasticIP:
    Type: AWS::EC2::EIP
    Properties:
      InstanceId: !Ref DevEC2Instance
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org5097085" class="outline-2">
<h2 id="org5097085">Parameter Types</h2>
<div class="outline-text-2" id="text-org5097085">
</div>
<div id="outline-container-org4e97a4b" class="outline-3">
<h3 id="org4e97a4b">Paramter Type : KeyName</h3>
<div class="outline-text-3" id="text-org4e97a4b">
<div class="org-src-container">
<pre class="src src-yaml">AWSTemplateFormatVersion: 2010-09-09
Description: KeyName Parameter demo

Parameters:
  MyKeyName:
    Description: Select the key name from the list
    Type: AWS::EC2::KeyPair::KeyName

Resources: 
  DevEC2Instance: 
    Type: 'AWS::EC2::Instance'
    Properties: 
      ImageId: ami-0cd3dfa4e37921605
      InstanceType: t2.micro
      KeyName: !Ref MyKeyName
      SecurityGroups:
	- default        
	- !Ref SSHSecurityGroup 
  SSHSecurityGroup:
    Type: 'AWS::EC2::SecurityGroup'
    Properties: 
      GroupDescription: my new SSH security group
      SecurityGroupIngress:
	- IpProtocol: tcp
	  FromPort: '22'
	  ToPort: '22'
	  CidrIp: 0.0.0.0/0
</pre>
</div>
</div>
</div>
<div id="outline-container-org6d0d8da" class="outline-3">
<h3 id="org6d0d8da">Parameter Type: String</h3>
<div class="outline-text-3" id="text-org6d0d8da">
<div class="org-src-container">
<pre class="src src-yaml">AWSTemplateFormatVersion: 2010-09-09
Description: AZ Parameter demo

Parameters:
  MyKeyName:
    Description: Select the key name from the list
    Type: AWS::EC2::KeyPair::KeyName
  MyAvailabilityZone:
    Description: Select the AZ
    Type: String
    Default: us-east-2a
    AllowedValues:
      - us-east-2a
      - us-east-2b    
      - us-east-2c

Resources: 
  DevEC2Instance: 
    Type: 'AWS::EC2::Instance'
    Properties: 
      ImageId: ami-0cd3dfa4e37921605
      InstanceType: t2.micro
      KeyName: !Ref MyKeyName
      SecurityGroups:
	- default        
	- !Ref SSHSecurityGroup 
      AvailabilityZone: !Ref MyAvailabilityZone      
  SSHSecurityGroup:
    Type: 'AWS::EC2::SecurityGroup'
    Properties: 
      GroupDescription: my new SSH security group
      SecurityGroupIngress:
	- IpProtocol: tcp
	  FromPort: '22'
	  ToPort: '22'
	  CidrIp: 0.0.0.0/0
</pre>
</div>
</div>
</div>

<div id="outline-container-org82cbcd3" class="outline-3">
<h3 id="org82cbcd3">Parameter Type: InstanceType</h3>
<div class="outline-text-3" id="text-org82cbcd3">
<div class="org-src-container">
<pre class="src src-yaml">AWSTemplateFormatVersion: 2010-09-09
Description: AZ Parameter demo

Parameters:
  MyKeyName:
    Description: Select the key name from the list
    Type: AWS::EC2::KeyPair::KeyName
  MyAvailabilityZone:
    Description: Select the AZ
    Type: String
    Default: us-east-2a
    AllowedValues:
      - us-east-2a
      - us-east-2b    
      - us-east-2c
  MyInstanceType:
    Description: Select the ec2 instance type from list
    Type: String      
    Default: t2.micro
    AllowedValues: 
      - t2.micro
      - t2.small

Resources: 
  DevEC2Instance: 
    Type: 'AWS::EC2::Instance'
    Properties: 
      ImageId: ami-0cd3dfa4e37921605
      InstanceType: !Ref MyInstanceType
      KeyName: !Ref MyKeyName
      SecurityGroups:
	- default        
	- !Ref SSHSecurityGroup 
      AvailabilityZone: !Ref MyAvailabilityZone      
  SSHSecurityGroup:
    Type: 'AWS::EC2::SecurityGroup'
    Properties: 
      GroupDescription: my new SSH security group
      SecurityGroupIngress:
	- IpProtocol: tcp
	  FromPort: '22'
	  ToPort: '22'
	  CidrIp: 0.0.0.0/0
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd0279af" class="outline-3">
<h3 id="orgd0279af">Parameter Type: SSM</h3>
<div class="outline-text-3" id="text-orgd0279af">
<p>
AWS Systems Manager Parameter Store (SSM) provides you with a secure way to store config variables for your applications. You can access SSM via AWS API directly from within the app or just use from AWS CLI. SSM can store plaintext parameters or KMS encrypted secure strings. Since parameters are identified by ARNs, you can set a fine grain access control to your configuration bits with IAM. A truely versatile service !
</p>

<p>
Common use cases of SSM are storing configuration for Docker containers initialisation during the runtime, storing secrets for Lambda functions and app, and even using SSM Parameters in CloudFormation.
</p>


<p>
<b>\(1^{st}\) Step:</b> Create SSM Parameter   <b>AWS Systems Manager Parameter Store</b> <a href="https://www.youtube.com/watch?v=zxi3M_rIE2k">Youtube Tutorial Link </a>  <br />
<b>\(2^{nd}\) Step:</b> Create a stack using below ssm.yml <br />
<b>\(3^{rd}\) Step:</b> Choose your paramter name in ssm <br />
</p>
<div class="org-src-container">
<pre class="src src-yaml">AWSTemplateFormatVersion: 2010-09-09
Description: AZ Parameter demo

Parameters:
  MyKeyName:
    Description: Select the key name from the list
    Type: AWS::EC2::KeyPair::KeyName
  MyAvailabilityZone:
    Description: Select the AZ
    Type: String
    Default: us-east-2a
    AllowedValues:
      - us-east-2a
      - us-east-2b    
      - us-east-2c
  MyInstanceType:
    Description: Select the ec2 instance type from SSM
    Type: AWS::SSM::Parameter::Value&lt;String&gt;

Resources: 
  DevEC2Instance: 
    Type: 'AWS::EC2::Instance'
    Properties: 
      ImageId: ami-0cd3dfa4e37921605
      InstanceType: !Ref MyInstanceType
      KeyName: !Ref MyKeyName
      SecurityGroups:
	- default        
	- !Ref SSHSecurityGroup 
      AvailabilityZone: !Ref MyAvailabilityZone      
  SSHSecurityGroup:
    Type: 'AWS::EC2::SecurityGroup'
    Properties: 
      GroupDescription: my new SSH security group
      SecurityGroupIngress:
	- IpProtocol: tcp
	  FromPort: '22'
	  ToPort: '22'
	  CidrIp: 0.0.0.0/0
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org10735e1" class="outline-2">
<h2 id="org10735e1">Mapping with Example</h2>
<div class="outline-text-2" id="text-org10735e1">
</div>
<div id="outline-container-org8552cad" class="outline-3">
<h3 id="org8552cad">Base Stack</h3>
<div class="outline-text-3" id="text-org8552cad">
<div class="org-src-container">
<pre class="src src-yaml">AWSTemplateFormatVersion: 2010-09-09
Resources:
  MyVMInstance:
    Type: AWS::EC2::Instance
    Properties:
      ImageId: ami-0cd3dfa4e37921605
      InstanceType: t2.micro
      KeyName: cfn-key-1
</pre>
</div>
</div>
</div>
<div id="outline-container-org9f08631" class="outline-3">
<h3 id="org9f08631">Mapping AMI</h3>
<div class="outline-text-3" id="text-org9f08631">
<div class="org-src-container">
<pre class="src src-yaml">AWSTemplateFormatVersion: 2010-09-09

Parameters:
  MyKeyName:
    Type: AWS::EC2::KeyPair::KeyName
    Description: Select the keypair

Mappings:
  MyRegionMap:
    us-east-2:
      HVM64: ami-0cd3dfa4e37921605
    us-west-1:
      HVM64: ami-0ec6517f6edbf8044     

Resources:
  MyVMInstance:
    Type: AWS::EC2::Instance
    Properties:
      ImageId: !FindInMap
	- MyRegionMap
	- !Ref 'AWS::Region'
	- HVM64
      InstanceType: t2.micro
      KeyName: !Ref MyKeyName
</pre>
</div>
</div>
</div>
<div id="outline-container-orgac511dc" class="outline-3">
<h3 id="orgac511dc">Mapping AMI with Environment</h3>
<div class="outline-text-3" id="text-orgac511dc">
<div class="org-src-container">
<pre class="src src-yaml">AWSTemplateFormatVersion: 2010-09-09

Parameters:
  MyKeyName:
    Type: AWS::EC2::KeyPair::KeyName
    Description: Select the keypair
  EnvironmentName:
    Description: Select the environment
    Type: String
    Default: dev
    AllowedValues: 
      - dev
      - prod


Mappings:
  MyRegionMap:
    us-east-2:
      HVM64: ami-0cd3dfa4e37921605
    us-west-1:
      HVM64: ami-0ec6517f6edbf8044     

  MyEnvironmentMap:
    dev:
      instanceType: t2.micro
    prod:
      instanceType: t2.small      

Resources:
  MyVMInstance:
    Type: AWS::EC2::Instance
    Properties:
      ImageId: !FindInMap
	- MyRegionMap
	- !Ref 'AWS::Region'
	- HVM64
      InstanceType: !FindInMap
	- MyEnvironmentMap
	- !Ref EnvironmentName
	- instanceType
      KeyName: !Ref MyKeyName
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4e9eab5" class="outline-2">
<h2 id="org4e9eab5">Condition</h2>
<div class="outline-text-2" id="text-org4e9eab5">
</div>
<div id="outline-container-org394cde5" class="outline-3">
<h3 id="org394cde5">Syntax</h3>
<div class="outline-text-3" id="text-org394cde5">

<div id="org213cc72" class="figure">
<p><img src="./Images/Screenshots_2023-02-25T14-32-53.png" alt="Screenshots_2023-02-25T14-32-53.png" />
</p>
</div>
</div>
</div>
<div id="outline-container-org2031543" class="outline-3">
<h3 id="org2031543">Condtion Intrinsic Function</h3>
<div class="outline-text-3" id="text-org2031543">
<ul class="org-ul">
<li>Fn::And</li>
<li>Fn::Equals</li>
<li>Fn::If</li>
<li>Fn::Not</li>
<li>Fn::Or</li>
</ul>
</div>
</div>

<div id="outline-container-orgd365e69" class="outline-3">
<h3 id="orgd365e69">Base</h3>
<div class="outline-text-3" id="text-orgd365e69">
<div class="org-src-container">
<pre class="src src-yaml">AWSTemplateFormatVersion: 2010-09-09
Description: Conditions Practice

Parameters:
  MyKeyName:
    Description: Select Key name
    Type: AWS::EC2::KeyPair::KeyName
  EnvironmentName:
    Description: Select the environment 
    Type: String
    Default: dev
    AllowedValues: 
      - dev
      - prod
    ConstraintDescription: must be development or production      

Mappings:     
  MyRegionMap:
    us-east-2:
      HVM64: ami-0cd3dfa4e37921605
    us-west-1:
      HVM64: ami-0ec6517f6edbf8044

  MyEnvironmentMap:
    dev:
      instanceType: t2.micro
    prod:
      instanceType: t2.small            

Resources:
  MyVMInstance:
    Type: AWS::EC2::Instance
    Properties:
      ImageId: !FindInMap
	- MyRegionMap
	- !Ref 'AWS::Region'
	- HVM64
      InstanceType: !FindInMap
	- MyEnvironmentMap
	- !Ref EnvironmentName
	- instanceType
      KeyName: !Ref MyKeyName
</pre>
</div>
</div>
</div>
<div id="outline-container-org34eff2d" class="outline-3">
<h3 id="org34eff2d">InstrinsicFunction-Fn-Equals</h3>
<div class="outline-text-3" id="text-org34eff2d">
<p>
Create a Elastic IP when environment is prod, use intrinsic Fn::Equals
</p>
<div class="org-src-container">
<pre class="src src-yaml">AWSTemplateFormatVersion: 2010-09-09
Description: Conditions Practice

Parameters:
  MyKeyName:
    Description: Select Key name
    Type: AWS::EC2::KeyPair::KeyName
  EnvironmentName:
    Description: Select the environment 
    Type: String
    Default: dev
    AllowedValues: 
      - dev
      - prod
    ConstraintDescription: must be development or production      

Mappings:     
  MyRegionMap:
    us-east-2:
      HVM64: ami-0cd3dfa4e37921605
    us-west-1:
      HVM64: ami-0ec6517f6edbf8044

  MyEnvironmentMap:
    dev:
      instanceType: t2.micro
    prod:
      instanceType: t2.small            

Conditions:
  CreateEIPForProd: !Equals [!Ref EnvironmentName, prod]


Resources:
  MyVMInstance:
    Type: AWS::EC2::Instance
    Properties:
      ImageId: !FindInMap
	- MyRegionMap
	- !Ref 'AWS::Region'
	- HVM64
      InstanceType: !FindInMap
	- MyEnvironmentMap
	- !Ref EnvironmentName
	- instanceType
      KeyName: !Ref MyKeyName

  MyProdEIP:
    Type: AWS::EC2::EIP
    Condition: CreateEIPForProd
    Properties:
      InstanceId: !Ref MyVMInstance
</pre>
</div>
</div>
</div>
<div id="outline-container-orge1b4183" class="outline-3">
<h3 id="orge1b4183">if PseudoParameter-NoValue</h3>
<div class="outline-text-3" id="text-orge1b4183">
<p>
Create a security group for dev environment when condition is met and demonsttrate Pesudo parameter "AWS::NoValue" for when environment is prod. Use Instrinsic function Fn::If
</p>

<div class="org-src-container">
<pre class="src src-yaml">AWSTemplateFormatVersion: 2010-09-09
Description: Conditions Practice

Parameters:
  MyKeyName:
    Description: Select Key name
    Type: AWS::EC2::KeyPair::KeyName
  EnvironmentName:
    Description: Select the environment 
    Type: String
    Default: dev
    AllowedValues: 
      - dev
      - prod
    ConstraintDescription: must be development or production      

Mappings:     
  MyRegionMap:
    us-east-2:
      HVM64: ami-0cd3dfa4e37921605
    us-west-1:
      HVM64: ami-0ec6517f6edbf8044

  MyEnvironmentMap:
    dev:
      instanceType: t2.micro
    prod:
      instanceType: t2.small            

Conditions:
  CreateEIPForProd: !Equals [!Ref EnvironmentName, prod]
  CreateDevSecurityGroup: !Equals [!Ref EnvironmentName, dev]

Resources:
  MyVMInstance:
    Type: AWS::EC2::Instance
    Properties:
      ImageId: !FindInMap
	- MyRegionMap
	- !Ref 'AWS::Region'
	- HVM64
      InstanceType: !FindInMap
	- MyEnvironmentMap
	- !Ref EnvironmentName
	- instanceType
      KeyName: !Ref MyKeyName
      SecurityGroups: !If [CreateDevSecurityGroup, [!Ref DevEnvSecurityGroup], !Ref 'AWS::NoValue']  

  MyProdEIP:
    Type: AWS::EC2::EIP
    Condition: CreateEIPForProd
    Properties:
      InstanceId: !Ref MyVMInstance

  DevEnvSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Condition: CreateDevSecurityGroup
    Properties:
      GroupDescription: DevSG
      SecurityGroupIngress:
	- IpProtocol: tcp
	  FromPort: '22'
	  ToPort: '22'
	  CidrIp: 0.0.0.0/0
</pre>
</div>
</div>
</div>
<div id="outline-container-orgdbf1bf1" class="outline-3">
<h3 id="orgdbf1bf1">Fn-if</h3>
<div class="outline-text-3" id="text-orgdbf1bf1">
<p>
Create a security group for prod env with  prod related conditon added. Use Intrinsic function  Fn::If
</p>
<div class="org-src-container">
<pre class="src src-yaml">AWSTemplateFormatVersion: 2010-09-09
Description: Conditions Practice

Parameters:
  MyKeyName:
    Description: Select Key name
    Type: AWS::EC2::KeyPair::KeyName
  EnvironmentName:
    Description: Select the environment 
    Type: String
    Default: dev
    AllowedValues: 
      - dev
      - prod
    ConstraintDescription: must be development or production      

Mappings:     
  MyRegionMap:
    us-east-2:
      HVM64: ami-0cd3dfa4e37921605
    us-west-1:
      HVM64: ami-0ec6517f6edbf8044

  MyEnvironmentMap:
    dev:
      instanceType: t2.micro
    prod:
      instanceType: t2.small            

Conditions:
  CreateEIPForProd: !Equals [!Ref EnvironmentName, prod]
  CreateDevSecurityGroup: !Equals [!Ref EnvironmentName, dev]
  CreateProdSecurityGroup: !Equals [!Ref EnvironmentName, prod]

Resources:
  MyVMInstance:
    Type: AWS::EC2::Instance
    Properties:
      ImageId: !FindInMap
	- MyRegionMap
	- !Ref 'AWS::Region'
	- HVM64
      InstanceType: !FindInMap
	- MyEnvironmentMap
	- !Ref EnvironmentName
	- instanceType
      KeyName: !Ref MyKeyName
      SecurityGroups: !If [CreateDevSecurityGroup, [!Ref DevEnvSecurityGroup], [!Ref ProdEnvSecurityGroup]]  

  MyProdEIP:
    Type: AWS::EC2::EIP
    Condition: CreateEIPForProd
    Properties:
      InstanceId: !Ref MyVMInstance

  DevEnvSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Condition: CreateDevSecurityGroup
    Properties:
      GroupDescription: DevSG
      SecurityGroupIngress:
	- IpProtocol: tcp
	  FromPort: '22'
	  ToPort: '22'
	  CidrIp: 0.0.0.0/0

  ProdEnvSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Condition: CreateProdSecurityGroup
    Properties:
      GroupDescription: ProdSG
      SecurityGroupIngress:
	- IpProtocol: tcp
	  FromPort: '22'
	  ToPort: '22'
	  CidrIp: 0.0.0.0/0
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd7c12b1" class="outline-3">
<h3 id="orgd7c12b1">Fn-Not</h3>
<div class="outline-text-3" id="text-orgd7c12b1">
<p>
Demonstate Fn::Not 
</p>
<div class="org-src-container">
<pre class="src src-yaml">AWSTemplateFormatVersion: 2010-09-09
Description: Conditions Practice

Parameters:
  MyKeyName:
    Description: Select Key name
    Type: AWS::EC2::KeyPair::KeyName
  EnvironmentName:
    Description: Select the environment 
    Type: String
    Default: dev
    AllowedValues: 
      - dev
      - prod
      - qa
    ConstraintDescription: must be development or production or qa     

Mappings:     
  MyRegionMap:
    us-east-2:
      HVM64: ami-0cd3dfa4e37921605
    us-west-1:
      HVM64: ami-0ec6517f6edbf8044

  MyEnvironmentMap:
    dev:
      instanceType: t2.micro
    prod:
      instanceType: t2.small  
    qa:
      instanceType: t2.medium                

Conditions:
  CreateEIPForProd: !Equals [!Ref EnvironmentName, prod]
  CreateProdSecurityGroup: !Equals [!Ref EnvironmentName, prod]
  CreateDevSecurityGroup: !Not [{Condition: CreateProdSecurityGroup}]


Resources:
  MyVMInstance:
    Type: AWS::EC2::Instance
    Properties:
      ImageId: !FindInMap
	- MyRegionMap
	- !Ref 'AWS::Region'
	- HVM64
      InstanceType: !FindInMap
	- MyEnvironmentMap
	- !Ref EnvironmentName
	- instanceType
      KeyName: !Ref MyKeyName
      SecurityGroups: !If [CreateDevSecurityGroup, [!Ref DevEnvSecurityGroup], [!Ref ProdEnvSecurityGroup]]  

  MyProdEIP:
    Type: AWS::EC2::EIP
    Condition: CreateEIPForProd
    Properties:
      InstanceId: !Ref MyVMInstance

  DevEnvSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Condition: CreateDevSecurityGroup
    Properties:
      GroupDescription: DevSG
      SecurityGroupIngress:
	- IpProtocol: tcp
	  FromPort: '22'
	  ToPort: '22'
	  CidrIp: 0.0.0.0/0

  ProdEnvSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Condition: CreateProdSecurityGroup
    Properties:
      GroupDescription: ProdSG
      SecurityGroupIngress:
	- IpProtocol: tcp
	  FromPort: '22'
	  ToPort: '22'
	  CidrIp: 0.0.0.0/0
</pre>
</div>
</div>
</div>
<div id="outline-container-org51f5dc9" class="outline-3">
<h3 id="org51f5dc9">Fn-Or</h3>
<div class="outline-text-3" id="text-org51f5dc9">
<div class="org-src-container">
<pre class="src src-yaml">AWSTemplateFormatVersion: 2010-09-09
Description: Conditions Practice

Parameters:
  EnvironmentName:
    Description: Select the environment 
    Type: String
    Default: dev
    AllowedValues: 
      - dev
      - prod
      - qa
    ConstraintDescription: must be development or production or qa     

Mappings:     
  MyRegionMap:
    us-east-2:
      HVM64: ami-0cd3dfa4e37921605
    us-west-1:
      HVM64: ami-0ec6517f6edbf8044

  MyEnvironmentMap:
    dev:
      instanceType: t2.micro
    prod:
      instanceType: t2.small  
    qa:
      instanceType: t2.medium                

Conditions:
  CreateEIPForProd: !Equals [!Ref EnvironmentName, prod]
  CreateProdSecurityGroup: !Equals [!Ref EnvironmentName, prod]
  CreateDevSecurityGroup: !Not [{Condition: CreateProdSecurityGroup}]
  IfRegionUseKeyName: !Or [!Equals [!Ref 'AWS::Region', us-east-2], !Equals [!Ref 'AWS::Region', us-west-1]]

Resources:
  MyVMInstance:
    Type: AWS::EC2::Instance
    Properties:
      ImageId: !FindInMap
	- MyRegionMap
	- !Ref 'AWS::Region'
	- HVM64
      InstanceType: !FindInMap
	- MyEnvironmentMap
	- !Ref EnvironmentName
	- instanceType
      KeyName: !If [IfRegionUseKeyName, cfn-key-1, cfn-key-2]
      SecurityGroups: !If [CreateDevSecurityGroup, [!Ref DevEnvSecurityGroup], [!Ref ProdEnvSecurityGroup]]  

  MyProdEIP:
    Type: AWS::EC2::EIP
    Condition: CreateEIPForProd
    Properties:
      InstanceId: !Ref MyVMInstance

  DevEnvSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Condition: CreateDevSecurityGroup
    Properties:
      GroupDescription: DevSG
      SecurityGroupIngress:
	- IpProtocol: tcp
	  FromPort: '22'
	  ToPort: '22'
	  CidrIp: 0.0.0.0/0

  ProdEnvSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Condition: CreateProdSecurityGroup
    Properties:
      GroupDescription: ProdSG
      SecurityGroupIngress:
	- IpProtocol: tcp
	  FromPort: '22'
	  ToPort: '22'
	  CidrIp: 0.0.0.0/0
</pre>
</div>
</div>
</div>
<div id="outline-container-org16c2136" class="outline-3">
<h3 id="org16c2136">Fn-And</h3>
<div class="outline-text-3" id="text-org16c2136">
<div class="org-src-container">
<pre class="src src-yaml">AWSTemplateFormatVersion: 2010-09-09
Description: Conditions Practice

Parameters:
  EnvironmentName:
    Description: Select the environment 
    Type: String
    Default: dev
    AllowedValues: 
      - dev
      - prod
      - qa
    ConstraintDescription: must be development or production or qa     

Mappings:     
  MyRegionMap:
    us-east-2:
      HVM64: ami-0cd3dfa4e37921605
    us-west-1:
      HVM64: ami-0ec6517f6edbf8044

  MyEnvironmentMap:
    dev:
      instanceType: t2.micro
    prod:
      instanceType: t2.small  
    qa:
      instanceType: t2.medium                

Conditions:
  CreateEIPForProd: !Equals [!Ref EnvironmentName, prod]
  CreateProdSecurityGroup: !Equals [!Ref EnvironmentName, prod]
  CreateDevSecurityGroup: !Not [{Condition: CreateProdSecurityGroup}]
  IfRegionUseKeyName: !And [!Or [!Equals [!Ref 'AWS::Region', us-east-2], !Equals [!Ref 'AWS::Region', us-west-1]], !Equals [!Ref EnvironmentName, dev]]

Resources:
  MyVMInstance:
    Type: AWS::EC2::Instance
    Properties:
      ImageId: !FindInMap
	- MyRegionMap
	- !Ref 'AWS::Region'
	- HVM64
      InstanceType: !FindInMap
	- MyEnvironmentMap
	- !Ref EnvironmentName
	- instanceType
      KeyName: !If [IfRegionUseKeyName, cfn-key-1, cfn-key-2]
      SecurityGroups: !If [CreateDevSecurityGroup, [!Ref DevEnvSecurityGroup], [!Ref ProdEnvSecurityGroup]]  

  MyProdEIP:
    Type: AWS::EC2::EIP
    Condition: CreateEIPForProd
    Properties:
      InstanceId: !Ref MyVMInstance

  DevEnvSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Condition: CreateDevSecurityGroup
    Properties:
      GroupDescription: DevSG
      SecurityGroupIngress:
	- IpProtocol: tcp
	  FromPort: '22'
	  ToPort: '22'
	  CidrIp: 0.0.0.0/0

  ProdEnvSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Condition: CreateProdSecurityGroup
    Properties:
      GroupDescription: ProdSG
      SecurityGroupIngress:
	- IpProtocol: tcp
	  FromPort: '22'
	  ToPort: '22'
	  CidrIp: 0.0.0.0/0
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org89e6014" class="outline-2">
<h2 id="org89e6014">Output</h2>
<div class="outline-text-2" id="text-org89e6014">
</div>
<div id="outline-container-org4baf166" class="outline-4">
<h4 id="org4baf166">Base</h4>
<div class="outline-text-4" id="text-org4baf166">
<div class="org-src-container">
<pre class="src src-yaml">AWSTemplateFormatVersion: 2010-09-09
Description: Outputs practice

Parameters:
  MyKeyName:
    Description: Select the Key Name
    Type: AWS::EC2::KeyPair::KeyName
  MyEnvironmentName:
    Description: Select the environment 
    Type: String
    Default: dev
    AllowedValues: 
      - dev
      - prod
    ConstraintDescription: must be development or production      

Mappings:     
  MyRegionMap:
    us-east-2:
      HVM64: ami-0cd3dfa4e37921605
    us-west-1:
      HVM64: ami-0ec6517f6edbf8044
  MyEnvironmentMap:
    dev:
      instanceType: t2.micro
    prod:
      instanceType: t2.small   

Resources:
  MyVMInstance:
    Type: AWS::EC2::Instance
    Properties:
      ImageId: !FindInMap
	- MyRegionMap
	- !Ref 'AWS::Region'
	- HVM64
      InstanceType: !FindInMap
	- MyEnvironmentMap
	- !Ref MyEnvironmentName
	- instanceType
      KeyName: !Ref MyKeyName
      SecurityGroups: 
	- !Ref MyDevGlobalSecurityGroup

  MyDevGlobalSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: My Dev environment Global Security Group
      SecurityGroupIngress:
	- IpProtocol: tcp
	  FromPort: '22'
	  ToPort: '22'
	  CidrIp: 0.0.0.0/0
</pre>
</div>
</div>
</div>
<div id="outline-container-org04c68c7" class="outline-4">
<h4 id="org04c68c7">InstanceID</h4>
<div class="outline-text-4" id="text-org04c68c7">
<div class="org-src-container">
<pre class="src src-yaml">AWSTemplateFormatVersion: 2010-09-09
Description: Outputs practice

Parameters:
  MyKeyName:
    Description: Select the Key Name
    Type: AWS::EC2::KeyPair::KeyName
  MyEnvironmentName:
    Description: Select the environment 
    Type: String
    Default: dev
    AllowedValues: 
      - dev
      - prod
    ConstraintDescription: must be development or production      

Mappings:     
  MyRegionMap:
    us-east-2:
      HVM64: ami-0cd3dfa4e37921605
    us-west-1:
      HVM64: ami-0ec6517f6edbf8044
  MyEnvironmentMap:
    dev:
      instanceType: t2.micro
    prod:
      instanceType: t2.small   

Resources:
  MyVMInstance:
    Type: AWS::EC2::Instance
    Properties:
      ImageId: !FindInMap
	- MyRegionMap
	- !Ref 'AWS::Region'
	- HVM64
      InstanceType: !FindInMap
	- MyEnvironmentMap
	- !Ref MyEnvironmentName
	- instanceType
      KeyName: !Ref MyKeyName
      SecurityGroups: 
	- !Ref MyDevGlobalSecurityGroup

  MyDevGlobalSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: My Dev environment Global Security Group
      SecurityGroupIngress:
	- IpProtocol: tcp
	  FromPort: '22'
	  ToPort: '22'
	  CidrIp: 0.0.0.0/0

Outputs:
  MyInstanceId:
    Description: My instance id
    Value: !Ref MyVMInstance
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf290e4e" class="outline-4">
<h4 id="orgf290e4e">Instrinsic Fn::GetAtt</h4>
<div class="outline-text-4" id="text-orgf290e4e">
<div class="org-src-container">
<pre class="src src-yaml">AWSTemplateFormatVersion: 2010-09-09
Description: Outputs practice

Parameters:
  MyKeyName:
    Description: Select the Key Name
    Type: AWS::EC2::KeyPair::KeyName
  MyEnvironmentName:
    Description: Select the environment 
    Type: String
    Default: dev
    AllowedValues: 
      - dev
      - prod
    ConstraintDescription: must be development or production      

Mappings:     
  MyRegionMap:
    us-east-2:
      HVM64: ami-0cd3dfa4e37921605
    us-west-1:
      HVM64: ami-0ec6517f6edbf8044
  MyEnvironmentMap:
    dev:
      instanceType: t2.micro
    prod:
      instanceType: t2.small   

Resources:
  MyVMInstance:
    Type: AWS::EC2::Instance
    Properties:
      ImageId: !FindInMap
	- MyRegionMap
	- !Ref 'AWS::Region'
	- HVM64
      InstanceType: !FindInMap
	- MyEnvironmentMap
	- !Ref MyEnvironmentName
	- instanceType
      KeyName: !Ref MyKeyName
      SecurityGroups: 
	- !Ref MyDevGlobalSecurityGroup

  MyDevGlobalSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: My Dev environment Global Security Group
      SecurityGroupIngress:
	- IpProtocol: tcp
	  FromPort: '22'
	  ToPort: '22'
	  CidrIp: 0.0.0.0/0

Outputs:
  MyInstanceId:
    Description: My instance id
    Value: !Ref MyVMInstance
  MyDNSName:
    Description: My Public DNS Name
    Value: !GetAtt MyVMInstance.PublicDnsName
  MyInstanceAvailabilityZone:
    Description: Instance Availability Zone
    Value: !GetAtt MyVMInstance.AvailabilityZone
</pre>
</div>
</div>
</div>
<div id="outline-container-org659e2b3" class="outline-4">
<h4 id="org659e2b3">Export Intrinsic Fn::Sub Pseudo StakName</h4>
<div class="outline-text-4" id="text-org659e2b3">
<div class="org-src-container">
<pre class="src src-yaml">AWSTemplateFormatVersion: 2010-09-09
Description: Outputs practice

Parameters:
  MyKeyName:
    Description: Select the Key Name
    Type: AWS::EC2::KeyPair::KeyName
  MyEnvironmentName:
    Description: Select the environment 
    Type: String
    Default: dev
    AllowedValues: 
      - dev
      - prod
    ConstraintDescription: must be development or production      

Mappings:     
  MyRegionMap:
    us-east-2:
      HVM64: ami-0cd3dfa4e37921605
    us-west-1:
      HVM64: ami-0ec6517f6edbf8044
  MyEnvironmentMap:
    dev:
      instanceType: t2.micro
    prod:
      instanceType: t2.small   

Resources:
  MyVMInstance:
    Type: AWS::EC2::Instance
    Properties:
      ImageId: !FindInMap
	- MyRegionMap
	- !Ref 'AWS::Region'
	- HVM64
      InstanceType: !FindInMap
	- MyEnvironmentMap
	- !Ref MyEnvironmentName
	- instanceType
      KeyName: !Ref MyKeyName
      SecurityGroups: 
	- !Ref MyDevGlobalSecurityGroup

  MyDevGlobalSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: My Dev environment Global Security Group
      SecurityGroupIngress:
	- IpProtocol: tcp
	  FromPort: '22'
	  ToPort: '22'
	  CidrIp: 0.0.0.0/0

Outputs:
  MyInstanceId:
    Description: My instance id
    Value: !Ref MyVMInstance
  MyDNSName:
    Description: My Public DNS Name
    Value: !GetAtt MyVMInstance.PublicDnsName
  MyInstanceAvailabilityZone:
    Description: Instance Availability Zone
    Value: !GetAtt MyVMInstance.AvailabilityZone    
    Export: 
      Name: !Sub "${AWS::StackName}-InstanceAz"
  MyDevGlobalSecurityGroup:
    Description: My Dev SG
    Value: !Ref MyDevGlobalSecurityGroup
    Export:
      Name: MyDevSSHGlobalSG
</pre>
</div>
</div>
</div>
<div id="outline-container-org38b5537" class="outline-4">
<h4 id="org38b5537">Cross Refeence Intrinsic Fn::ImportValue</h4>
<div class="outline-text-4" id="text-org38b5537">
<div class="org-src-container">
<pre class="src src-yaml">AWSTemplateFormatVersion: 2010-09-09
Description: Outputs practice

Parameters:
  MyKeyName:
    Description: Select the Key Name
    Type: AWS::EC2::KeyPair::KeyName
  MyEnvironmentName:
    Description: Select the environment 
    Type: String
    Default: dev
    AllowedValues: 
      - dev
      - prod
    ConstraintDescription: must be development or production      

Mappings:     
  MyRegionMap:
    us-east-2:
      HVM64: ami-0cd3dfa4e37921605
    us-west-1:
      HVM64: ami-0ec6517f6edbf8044
  MyEnvironmentMap:
    dev:
      instanceType: t2.micro
    prod:
      instanceType: t2.small   

Resources:
  MyVMInstance:
    Type: AWS::EC2::Instance
    Properties:
      ImageId: !FindInMap
	- MyRegionMap
	- !Ref 'AWS::Region'
	- HVM64
      InstanceType: !FindInMap
	- MyEnvironmentMap
	- !Ref MyEnvironmentName
	- instanceType
      KeyName: !Ref MyKeyName
      SecurityGroups: 
	- !ImportValue MyDevSSHGlobalSG
      AvailabilityZone: !ImportValue stack1-InstanceAz
</pre>
</div>
</div>
</div>
<div id="outline-container-org06d821a" class="outline-4">
<h4 id="org06d821a">Output Conditions</h4>
<div class="outline-text-4" id="text-org06d821a">
<div class="org-src-container">
<pre class="src src-yaml">AWSTemplateFormatVersion: 2010-09-09
Description: Outputs practice

Parameters:
  MyKeyName:
    Description: Select the Key Name
    Type: AWS::EC2::KeyPair::KeyName
  MyEnvironmentName:
    Description: Select the environment 
    Type: String
    Default: dev
    AllowedValues: 
      - dev
      - prod
    ConstraintDescription: must be development or production      

Mappings:     
  MyRegionMap:
    us-east-2:
      HVM64: ami-0cd3dfa4e37921605
    us-west-1:
      HVM64: ami-0ec6517f6edbf8044
  MyEnvironmentMap:
    dev:
      instanceType: t2.micro
    prod:
      instanceType: t2.small   

Conditions:
  CreateDevSecurityGroup: !Equals [!Ref MyEnvironmentName, dev]

Resources:
  MyVMInstance:
    Type: AWS::EC2::Instance
    Properties:
      ImageId: !FindInMap
	- MyRegionMap
	- !Ref 'AWS::Region'
	- HVM64
      InstanceType: !FindInMap
	- MyEnvironmentMap
	- !Ref MyEnvironmentName
	- instanceType
      KeyName: !Ref MyKeyName
      SecurityGroups: !If [CreateDevSecurityGroup, [!Ref MyDevGlobalSecurityGroup], !Ref 'AWS::NoValue']


  MyDevGlobalSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Condition: CreateDevSecurityGroup
    Properties:
      GroupDescription: My Dev environment Global Security Group
      SecurityGroupIngress:
	- IpProtocol: tcp
	  FromPort: '22'
	  ToPort: '22'
	  CidrIp: 0.0.0.0/0

Outputs:
  MyInstanceId:
    Description: My instance id
    Value: !Ref MyVMInstance
  MyDNSName:
    Description: My Public DNS Name
    Value: !GetAtt MyVMInstance.PublicDnsName
  MyInstanceAvailabilityZone:
    Description: Instance Availability Zone
    Value: !GetAtt MyVMInstance.AvailabilityZone    
    Export: 
      Name: !Sub "${AWS::StackName}-InstanceAz"
  MyDevGlobalSecurityGroup:
    Description: My Dev SG
    Value: !Ref MyDevGlobalSecurityGroup
    Condition: CreateDevSecurityGroup
    Export:
      Name: MyDevSSHGlobalSG
</pre>
</div>
</div>
</div>
<div id="outline-container-org376b481" class="outline-4">
<h4 id="org376b481">Output Export Intrinsic Fn:Join</h4>
<div class="outline-text-4" id="text-org376b481">
<div class="org-src-container">
<pre class="src src-yaml">AWSTemplateFormatVersion: 2010-09-09
Description: Outputs practice

Parameters:
  MyKeyName:
    Description: Select the Key Name
    Type: AWS::EC2::KeyPair::KeyName
  MyEnvironmentName:
    Description: Select the environment 
    Type: String
    Default: dev
    AllowedValues: 
      - dev
      - prod
    ConstraintDescription: must be development or production      

Mappings:     
  MyRegionMap:
    us-east-2:
      HVM64: ami-0cd3dfa4e37921605
    us-west-1:
      HVM64: ami-0ec6517f6edbf8044
  MyEnvironmentMap:
    dev:
      instanceType: t2.micro
    prod:
      instanceType: t2.small   

Conditions:
  CreateDevSecurityGroup: !Equals [!Ref MyEnvironmentName, dev]

Resources:
  MyVMInstance:
    Type: AWS::EC2::Instance
    Properties:
      ImageId: !FindInMap
	- MyRegionMap
	- !Ref 'AWS::Region'
	- HVM64
      InstanceType: !FindInMap
	- MyEnvironmentMap
	- !Ref MyEnvironmentName
	- instanceType
      KeyName: !Ref MyKeyName
      SecurityGroups: !If [CreateDevSecurityGroup, [!Ref MyDevGlobalSecurityGroup], !Ref 'AWS::NoValue']


  MyDevGlobalSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Condition: CreateDevSecurityGroup
    Properties:
      GroupDescription: My Dev environment Global Security Group
      SecurityGroupIngress:
	- IpProtocol: tcp
	  FromPort: '22'
	  ToPort: '22'
	  CidrIp: 0.0.0.0/0

Outputs:
  MyInstanceId:
    Description: My instance id
    Value: !Ref MyVMInstance
  MyDNSName:
    Description: My Public DNS Name
    Value: !GetAtt MyVMInstance.PublicDnsName
  MyInstanceAvailabilityZone:
    Description: Instance Availability Zone
    Value: !GetAtt MyVMInstance.AvailabilityZone    
    Export: 
      Name: !Sub "${AWS::StackName}-InstanceAz"
  MyDevGlobalSecurityGroup:
    Description: My Dev SG
    Value: !Ref MyDevGlobalSecurityGroup
    Condition: CreateDevSecurityGroup
    Export:
      Name: !Join ["-", [!Ref 'AWS::StackName', MyDevSSHGlobalSG]]
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgca92c11" class="outline-2">
<h2 id="orgca92c11">MetaData</h2>
<div class="outline-text-2" id="text-orgca92c11">
</div>
<div id="outline-container-org4996616" class="outline-4">
<h4 id="org4996616">Base</h4>
<div class="outline-text-4" id="text-org4996616">
<div class="org-src-container">
<pre class="src src-yaml">AWSTemplateFormatVersion: 2010-09-09

Parameters:
  EnvironmentName:
    Description: Select the environment 
    Type: String
    Default: dev
    AllowedValues: 
      - dev
      - prod
    ConstraintDescription: must be development or production      
  InstanceType: 
    Description: Select the ec2 instance type
    Type: String
    Default: t2.micro
    AllowedValues: 
      - t2.micro
      - t2.small
      - t2.medium
  KeyName:
    Description: Key name to SSH to VM's. 
    Type: AWS::EC2::KeyPair::KeyName
  AvailabilityZone:
    Description: select the availability zone
    Type: String
    Default: us-east-2a
    AllowedValues:
      - us-east-2a
      - us-east-2b
      - us-east-2c


Conditions:
  CreateEIPForProd: !Equals [!Ref EnvironmentName, prod]

Resources:
  MyVMInstance:
    Type: AWS::EC2::Instance
    Properties:
      ImageId: ami-0cd3dfa4e37921605
      InstanceType: !Ref InstanceType
      KeyName: !Ref KeyName
      AvailabilityZone: !Ref AvailabilityZone

  MyProdEIP:
    Type: AWS::EC2::EIP
    Condition: CreateEIPForProd
    Properties: 
      InstanceId: !Ref MyVMInstance
</pre>
</div>
</div>
</div>
<div id="outline-container-org340ec3d" class="outline-4">
<h4 id="org340ec3d">Metadata Interface</h4>
<div class="outline-text-4" id="text-org340ec3d">
<div class="org-src-container">
<pre class="src src-yaml">AWSTemplateFormatVersion: 2010-09-09

Parameters:
  EnvironmentName:
    Description: Select the environment 
    Type: String
    Default: dev
    AllowedValues: 
      - dev
      - prod
    ConstraintDescription: must be development or production      
  InstanceType: 
    Description: Select the ec2 instance type
    Type: String
    Default: t2.micro
    AllowedValues: 
      - t2.micro
      - t2.small
      - t2.medium
  KeyName:
    Description: Key name to SSH to VM's. 
    Type: AWS::EC2::KeyPair::KeyName
  AvailabilityZone:
    Description: select the availability zone
    Type: String
    Default: us-east-2a
    AllowedValues:
      - us-east-2a
      - us-east-2b
      - us-east-2c


Conditions:
  CreateEIPForProd: !Equals [!Ref EnvironmentName, prod]

Metadata:
  AWS::CloudFormation::Interface:
    ParameterGroups:
      - Label:
	  default: "EC2 Instance Configuration"    
	Parameters:
	  - InstanceType
	  - KeyName
	  - AvailabilityZone  
      - Label:
	  default: "Environment Configuration"          
	Parameters:
	  - EnvironmentName  
    ParameterLabels:
      EnvironmentName:
	default: "Which environment we are planning to create this instance?"
      KeyName:
	default: "Be aware that once keyname is selected we cannot change it unless instance replaced"

Resources:
  MyVMInstance:
    Type: AWS::EC2::Instance
    Properties:
      ImageId: ami-0cd3dfa4e37921605
      InstanceType: !Ref InstanceType
      KeyName: !Ref KeyName
      AvailabilityZone: !Ref AvailabilityZone

  MyProdEIP:
    Type: AWS::EC2::EIP
    Condition: CreateEIPForProd
    Properties: 
      InstanceId: !Ref MyVMInstance
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org902536e" class="outline-2">
<h2 id="org902536e">EC2 UserData</h2>
<div class="outline-text-2" id="text-org902536e">
</div>
<div id="outline-container-orgc134152" class="outline-4">
<h4 id="orgc134152">Base</h4>
<div class="outline-text-4" id="text-orgc134152">
<div class="org-src-container">
<pre class="src src-yaml">AWSTemplateFormatVersion: 2010-09-09

Parameters:
  EnvironmentName:
    Description: Select the environment 
    Type: String
    Default: dev
    AllowedValues: 
      - dev
      - prod
    ConstraintDescription: must be development or production      
  InstanceType: 
    Description: Select the ec2 instance type
    Type: String
    Default: t2.micro
    AllowedValues: 
      - t2.micro
      - t2.small
      - t2.medium
  KeyName:
    Description: Key name to SSH to VM's. 
    Type: AWS::EC2::KeyPair::KeyName
  AvailabilityZone:
    Description: select the availability zone
    Type: String
    Default: us-east-2a
    AllowedValues:
      - us-east-2a
      - us-east-2b
      - us-east-2c


Conditions:
  CreateEIPForProd: !Equals [!Ref EnvironmentName, prod]

Metadata:
  AWS::CloudFormation::Interface:
    ParameterGroups:
      - Label:
	  default: "EC2 Instance Configuration"    
	Parameters:
	  - InstanceType
	  - KeyName
	  - AvailabilityZone  
      - Label:
	  default: "Environment Configuration"          
	Parameters:
	  - EnvironmentName  
    ParameterLabels:
      EnvironmentName:
	default: "Which environment we are planning to create this instance?"
      KeyName:
	default: "Be aware that once keyname is selected we cannot change it unless instance replaced"

Resources:
  MyVMInstance:
    Type: AWS::EC2::Instance
    Properties:
      ImageId: ami-0cd3dfa4e37921605
      InstanceType: !Ref InstanceType
      KeyName: !Ref KeyName
      AvailabilityZone: !Ref AvailabilityZone

  MyProdEIP:
    Type: AWS::EC2::EIP
    Condition: CreateEIPForProd
    Properties: 
      InstanceId: !Ref MyVMInstance
</pre>
</div>
</div>
</div>

<div id="outline-container-org4b69ec9" class="outline-4">
<h4 id="org4b69ec9">shell script</h4>
<div class="outline-text-4" id="text-org4b69ec9">
<div class="org-src-container">
<pre class="src src-sh">#file name: 10-00-Userdata
	  #!/bin/bash
	  sudo yum update
	  sudo yum -y erase java-1.7.0-openjdk.x86_64
	  sudo yum -y install java-1.8.0-openjdk.x86_64
	  sudo yum -y install java-1.8.0-openjdk-devel
	  sudo yum -y install tomcat8
	  service tomcat8 start
	  mkdir /usr/share/tomcat8/webapps/ROOT
	  touch /usr/share/tomcat8/webapps/ROOT/index.html
	  echo "Cloud Formation Tomcat8" &gt; /usr/share/tomcat8/webapps/ROOT/index.html
</pre>
</div>
</div>
</div>
<div id="outline-container-orga7d8ca5" class="outline-4">
<h4 id="orga7d8ca5">UserData</h4>
<div class="outline-text-4" id="text-orga7d8ca5">
<div class="org-src-container">
<pre class="src src-yaml">AWSTemplateFormatVersion: 2010-09-09

Parameters:
  EnvironmentName:
    Description: Select the environment 
    Type: String
    Default: dev
    AllowedValues: 
      - dev
      - prod
    ConstraintDescription: must be development or production      
  InstanceType: 
    Description: Select the ec2 instance type
    Type: String
    Default: t2.micro
    AllowedValues: 
      - t2.micro
      - t2.small
      - t2.medium
  KeyName:
    Description: Key name to SSH to VM's. 
    Type: AWS::EC2::KeyPair::KeyName
  AvailabilityZone:
    Description: select the availability zone
    Type: String
    Default: us-east-2a
    AllowedValues:
      - us-east-2a
      - us-east-2b
      - us-east-2c


Conditions:
  CreateEIPForProd: !Equals [!Ref EnvironmentName, prod]

Metadata:
  AWS::CloudFormation::Interface:
    ParameterGroups:
      - Label:
	  default: "EC2 Instance Configuration"    
	Parameters:
	  - InstanceType
	  - KeyName
	  - AvailabilityZone  
      - Label:
	  default: "Environment Configuration"          
	Parameters:
	  - EnvironmentName  
    ParameterLabels:
      EnvironmentName:
	default: "Which environment we are planning to create this instance?"
      KeyName:
	default: "Be aware that once keyname is selected we cannot change it unless instance replaced"

Resources:
  MySecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: My SG with port 22, 8080 and 80 inbound
      SecurityGroupIngress:
	- IpProtocol: tcp
	  FromPort: '22'
	  ToPort: '22'
	  CidrIp: 0.0.0.0/0
	- IpProtocol: tcp
	  FromPort: '8080'          
	  ToPort: '8080'
	  CidrIp: 0.0.0.0/0

  MyVMInstance:
    Type: AWS::EC2::Instance
    Properties:
      ImageId: ami-0cd3dfa4e37921605
      InstanceType: !Ref InstanceType
      KeyName: !Ref KeyName
      AvailabilityZone: !Ref AvailabilityZone
      SecurityGroups:
	- !Ref MySecurityGroup
      UserData: 
	Fn::Base64: |  
	  #!/bin/bash
	  sudo yum update
	  sudo yum -y erase java-1.7.0-openjdk.x86_64
	  sudo yum -y install java-1.8.0-openjdk.x86_64
	  sudo yum -y install java-1.8.0-openjdk-devel
	  sudo yum -y install tomcat8
	  service tomcat8 start
	  mkdir /usr/share/tomcat8/webapps/ROOT
	  touch /usr/share/tomcat8/webapps/ROOT/index.html
	  echo "Cloud Formation Tomcat8" &gt; /usr/share/tomcat8/webapps/ROOT/index.html


  MyProdEIP:
    Type: AWS::EC2::EIP
    Condition: CreateEIPForProd
    Properties: 
      InstanceId: !Ref MyVMInstance


Outputs:
  AppURL:
    Description: Tomcat App Access URL
    Value: !Sub 'http://${MyVMInstance.PublicDnsName}:8080/index.html'
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb1f6892" class="outline-2">
<h2 id="orgb1f6892">CFN-init</h2>
</div>
<div id="outline-container-org9005c15" class="outline-2">
<h2 id="org9005c15">Configsets</h2>
</div>
<div id="outline-container-orgc8b17ee" class="outline-2">
<h2 id="orgc8b17ee">NestedStacks</h2>
<div class="outline-text-2" id="text-orgc8b17ee">
</div>
<div id="outline-container-org987972e" class="outline-4">
<h4 id="org987972e">NestedStack VPC</h4>
<div class="outline-text-4" id="text-org987972e">
<div class="org-src-container">
<pre class="src src-yaml">#https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/AWS_EC2.html
AWSTemplateFormatVersion: '2010-09-09'
Description: VPC Nested Stack Template

Parameters:
  VpcBlock:
    Type: String
    Default: 10.0.0.0/16
    Description: VPC CIDR Tange

  Subnet01Block:
    Type: String
    Default: 10.0.1.0/24
    Description: CidrBlock for Subnet 01 within the VPC.        

Metadata:
  AWS::CloudFormation::Interface:
    ParameterGroups:
      - Label:
	  default: Dev VPC Network Configuration
	  Parameters:
	    - VpcBlock
	    - Subnet01Block        
    ParameterLabels:
      VpcBlock:
	default: VPC CIDR Range selection                        

Resources:
  myVPC:
    Type: AWS::EC2::VPC
    Properties:
      CidrBlock: !Ref VpcBlock
      EnableDnsHostnames: true
      EnableDnsSupport: true
      Tags:
	- Key: Name
	  Value: !Sub "${AWS::StackName}-myVPC"

  Subnet01:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: !Ref myVPC
      CidrBlock: !Ref Subnet01Block 
      Tags:
	- Key: Name
	  Value: !Sub "${AWS::StackName}-Subnet01"    
      AvailabilityZone: 
	Fn::Select:
	  - '0'
	  - Fn::GetAZs:
	      Ref: AWS::Region

  RouteTable:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId: !Ref myVPC               
      Tags: 
	- Key: Name
	  Value: Public Subnets
	- Key: Network
	  Value: Public          

  Subnet01RouteTableAssociation:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      SubnetId: !Ref Subnet01
      RouteTableId: !Ref RouteTable

  InternetGateway:
    Type: AWS::EC2::InternetGateway

  VPCGatewayAttachment:
    Type: AWS::EC2::VPCGatewayAttachment
    Properties:
      InternetGatewayId: !Ref InternetGateway
      VpcId: !Ref myVPC    

  Route: 
    DependsOn: VPCGatewayAttachment
    Type: AWS::EC2::Route
    Properties:
      RouteTableId: !Ref RouteTable  
      DestinationCidrBlock: 0.0.0.0/0
      GatewayId: !Ref InternetGateway    

Outputs:
  Subnet01Id:
    Description: Subnet 01 Id
    Value: !Ref Subnet01

  VpcId:
    Description: Vpc Id
    Value: !Ref myVPC
</pre>
</div>
</div>
</div>

<div id="outline-container-org147daed" class="outline-4">
<h4 id="org147daed">Root Stack EC2-VPC</h4>
<div class="outline-text-4" id="text-org147daed">
<div class="org-src-container">
<pre class="src src-yaml">AWSTemplateFormatVersion: '2010-09-09'
Description: Root Stack Template

Parameters:
  MyKeyName:
    Type: AWS::EC2::KeyPair::KeyName

  VpcBlock:
    Type: String
    Default: 10.0.0.0/16
    Description: VPC CIDR Tange

  Subnet01Block:
    Type: String
    Default: 10.0.1.0/24
    Description: CidrBlock for Subnet 01 within the VPC.    

Resources:

  VPCStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: https://s3.us-east-2.amazonaws.com/nestedbucket0189/nestedstacks/13-01-NestedStack-VPC.yml 
      Parameters:  
	VpcBlock: !Ref VpcBlock
	Subnet01Block: !Ref Subnet01Block 
      TimeoutInMinutes: 5            


  MyVMInstance:
    Type: AWS::EC2::Instance
    Properties:
      ImageId: ami-04768381bf606e2b3
      InstanceType: t2.micro
      KeyName: !Ref MyKeyName
      NetworkInterfaces:
	- AssociatePublicIpAddress: "true"
	  DeviceIndex: "0"
	  SubnetId: !GetAtt VPCStack.Outputs.Subnet01Id
      UserData: 
	Fn::Base64: |
	  #!/bin/bash
	  sudo yum update
	  sudo yum -y erase java-1.7.0-openjdk.x86_64
	  sudo yum -y install java-1.8.0-openjdk.x86_64
	  sudo yum -y install java-1.8.0-openjdk-devel
	  sudo yum -y install tomcat8
	  service tomcat8 start
	  mkdir /usr/share/tomcat8/webapps/ROOT
	  touch /usr/share/tomcat8/webapps/ROOT/index.html
	  echo "Cloud Formation Tomcat8" &gt; /usr/share/tomcat8/webapps/ROOT/index.html

Outputs:
  AppURL:
    Description: Application URL to access
    Value: !Sub 'http://${MyVMInstance.PublicDnsName}:8080/index.html'
</pre>
</div>
</div>
</div>


<div id="outline-container-orgef3742e" class="outline-4">
<h4 id="orgef3742e">NestedStack-SG</h4>
<div class="outline-text-4" id="text-orgef3742e">
<div class="org-src-container">
<pre class="src src-yaml">AWSTemplateFormatVersion: '2010-09-09'
Description: Root Stack Template

Parameters:
  VPCId: 
    Description: Create security group in this respective VPC
    Type: AWS::EC2::VPC::Id


Resources:
  DevSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: Dev Apps Security Group
      SecurityGroupIngress:
	- IpProtocol: tcp
	  FromPort: '22'
	  ToPort: '22'
	  CidrIp: 0.0.0.0/0
	- IpProtocol: tcp
	  FromPort: '8080'
	  ToPort: '8080'
	  CidrIp: 0.0.0.0/0
      VpcId: !Ref VPCId

Outputs:
  DevSGGroupId:
    Description: Dev Security Group
    Value: !Ref DevSecurityGroup                   
</pre>
</div>
</div>
</div>
<div id="outline-container-org25e7ee3" class="outline-4">
<h4 id="org25e7ee3">RootStack -ECE-SG</h4>
<div class="outline-text-4" id="text-org25e7ee3">
<div class="org-src-container">
<pre class="src src-yaml">AWSTemplateFormatVersion: '2010-09-09'
Description: Root Stack Template

Parameters:
  MyKeyName:
    Type: AWS::EC2::KeyPair::KeyName

  VpcBlock:
    Type: String
    Default: 10.0.0.0/16
    Description: VPC CIDR Tange

  Subnet01Block:
    Type: String
    Default: 10.0.1.0/24
    Description: CidrBlock for Subnet 01 within the VPC.    

Resources:

  VPCStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: https://s3.us-east-2.amazonaws.com/nestedbucket0189/nestedstacks/13-01-NestedStack-VPC.yml 
      Parameters:  
	VpcBlock: !Ref VpcBlock
	Subnet01Block: !Ref Subnet01Block 
      TimeoutInMinutes: 5            

  SecurityGroupStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: https://s3.us-east-2.amazonaws.com/nestedbucket0189/nestedstacks/13-03-NestedStack-SG.yml
      Parameters:
	VPCId: !GetAtt VPCStack.Outputs.VpcId
      TimeoutInMinutes: 5        

  MyVMInstance:
    Type: AWS::EC2::Instance
    Properties:
      ImageId: ami-04768381bf606e2b3
      InstanceType: t2.micro
      KeyName: !Ref MyKeyName
      NetworkInterfaces:
	- AssociatePublicIpAddress: "true"
	  DeviceIndex: "0"
	  SubnetId: !GetAtt VPCStack.Outputs.Subnet01Id
	  GroupSet:
	    - !GetAtt SecurityGroupStack.Outputs.DevSGGroupId
      UserData: 
	Fn::Base64: |
	  #!/bin/bash
	  sudo yum update
	  sudo yum -y erase java-1.7.0-openjdk.x86_64
	  sudo yum -y install java-1.8.0-openjdk.x86_64
	  sudo yum -y install java-1.8.0-openjdk-devel
	  sudo yum -y install tomcat8
	  service tomcat8 start
	  mkdir /usr/share/tomcat8/webapps/ROOT
	  touch /usr/share/tomcat8/webapps/ROOT/index.html
	  echo "Cloud Formation Tomcat8" &gt; /usr/share/tomcat8/webapps/ROOT/index.html

Outputs:
  AppURL:
    Description: Application URL to access
    Value: !Sub 'http://${MyVMInstance.PublicDnsName}:8080/index.html'            
</pre>
</div>
</div>
</div>
<div id="outline-container-org9c56ba8" class="outline-3">
<h3 id="org9c56ba8">Manual Steps to Create VPC</h3>
<div class="outline-text-3" id="text-org9c56ba8">
<ul class="org-ul">
<li>Step #1: Create VPC</li>
<li>Step #2: Create Subnet</li>
<li>Step #3: Create Route Table (Ignore default Main Route Table)</li>
<li>Step #4: Associate Subnet in Route Table</li>
<li>Step #5: Create Internet Gateway</li>
<li>Step #6: Associate Internet Gateway to VPC</li>
<li>Step #7: Create Route to allow internet traffic via IGW</li>
</ul>

<p>
VPC &#x2013; YES
Subnet  &#x2013; YES
Route Table   &#x2013; YES
Internet Gateway  &#x2013; YES
</p>
<div class="org-src-container">
<pre class="src src-sh">#!/bin/bash
sudo yum update
sudo yum -y erase java-1.7.0-openjdk.x86_64
sudo yum -y install java-1.8.0-openjdk.x86_64
sudo yum -y install java-1.8.0-openjdk-devel
sudo yum -y install tomcat8
service tomcat8 start
mkdir /usr/share/tomcat8/webapps/ROOT
touch /usr/share/tomcat8/webapps/ROOT/index.html
echo "Cloud Formation Tomcat8" &gt; /usr/share/tomcat8/webapps/ROOT/index.html
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org439497f" class="outline-2">
<h2 id="org439497f">Continous Delivery</h2>
</div>
<div id="outline-container-orgeb4abe4" class="outline-2">
<h2 id="orgeb4abe4">Infrasturcture As Code</h2>
</div>
<div id="outline-container-org5a379bd" class="outline-2">
<h2 id="org5a379bd">StackPolicy</h2>
</div>
<div id="outline-container-orgd1cf8f4" class="outline-2">
<h2 id="orgd1cf8f4">Additional Templates</h2>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: DeepAlgorithms</p>
<p class="date">Created: 2023-03-16 Thu 11:44</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
