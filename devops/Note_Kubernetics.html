<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2023-03-16 Thu 11:43 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Note_Kubernetics</title>
<meta name="author" content="Karthik" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="icon" type="image/png" href="https://deepalgorithms.in/assets/icons/favicon.png">
<link rel="stylesheet" type="text/css" href="readtheorg-htmlize.css"/>
<link rel="stylesheet" type="text/css" href="readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Note<sub>Kubernetics</sub></h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org169a6a8">############ Udemy ############</a></li>
<li><a href="#org82c4185">k8 installation</a>
<ul>
<li><a href="#orgcb1ff77">Intro</a></li>
<li><a href="#org37c0ec0">Kubernetics Ubuntu installation</a></li>
<li><a href="#orge7108a3">Vagrant for Kubernetis step 3 VM using vagrant</a></li>
</ul>
</li>
<li><a href="#org684c01c">Kuberneteics(K8) Why/What [89]</a>
<ul>
<li><a href="#org684ba74">Kubernetics or Swarm</a></li>
<li><a href="#org0ac8c61">Architecture Terminology</a></li>
<li><a href="#orgfc6bd6a"><span class="todo TODO">TODO</span> insert the image</a></li>
<li><a href="#org7ee0063">k8s Container Abstraction:</a></li>
</ul>
</li>
<li><a href="#org78c0496">Creat 1st Pods</a></li>
<li><a href="#org7e01f7b"><span class="todo TODO">TODO</span> insert image of</a></li>
<li><a href="#org3d3b5f5">Scaling ReplicaSets</a></li>
<li><a href="#org2264a92"><span class="todo TODO">TODO</span> insert image  tiff with crop</a></li>
<li><a href="#orgd0f57e1">Inspecting Deploy</a></li>
<li><a href="#orgb8496e5">Services (Network )</a></li>
<li><a href="#org4c229a4">Create a ClusterIP</a></li>
<li><a href="#orgc009931">Create NodePort and Loadbalancer service</a></li>
<li><a href="#org51d908f">Core DNS:</a></li>
<li><a href="#org2d315c4">Kubernetes Managment Techniques</a></li>
<li><a href="#org84f264e">Run Expose create Generateor &lt;kube cmd's&gt;</a>
<ul>
<li><a href="#org0725d02">Generator Example</a></li>
</ul>
</li>
<li><a href="#org79f2b0e">Future of kubectl run</a></li>
<li><a href="#org759575d">Imperative vs Declarive</a>
<ul>
<li><a href="#org9d9d503">Three Management Approaches</a></li>
</ul>
</li>
<li><a href="#org89181d3">Section</a></li>
<li><a href="#orgcc07020">Kubectl apply</a></li>
<li><a href="#org394bab6">Configure yaml</a></li>
<li><a href="#orge1f793c">Build your yaml file</a></li>
<li><a href="#org88c7876"><span class="todo TODO">TODO</span> video 106 from udemy</a></li>
<li><a href="#org5d417f5"><span class="timestamp-wrapper"><span class="timestamp">&lt;2021-10-06 Wed 09:11&gt; </span></span> Meeting: Abhutahir and Venkat &lt;Install and configure kubernetecis&gt;</a></li>
<li><a href="#orgc909fcf">Pull Docker images from GitLab Container Registry in Kubernetes Cluster</a></li>
<li><a href="#org214ab84"><span class="timestamp-wrapper"><span class="timestamp">&lt;2021-10-09 Sat 11:14&gt; </span></span> Meeting: abhutahir and venkatesh &lt;Task: 2-week know kubernetics&gt;</a></li>
<li><a href="#orga74f254"><span class="timestamp-wrapper"><span class="timestamp">&lt;2021-10-11 Mon 15:03&gt; </span></span> Meeting : abhutahir and google Kushal Kashyap &lt;for gcp and azure tranning&gt;</a></li>
<li><a href="#orga83dc5c"><span class="timestamp-wrapper"><span class="timestamp">&lt;2021-10-11 Mon 15:48&gt; </span></span> Meeting: Venkat &lt;installation of kubenetes&gt;</a></li>
<li><a href="#org078c718">cmd</a></li>
<li><a href="#org616e9b8">curl: (7) Failed to connect to localhost port 80: Connection refused</a></li>
<li><a href="#org28f0337"><span class="timestamp-wrapper"><span class="timestamp">&lt;2021-10-12 Tue 17:00&gt; </span></span> Meeting: Venkat  &lt;Kubernetics Serivce-Type&gt;</a>
<ul>
<li><a href="#org030f1a4">Intro to Service-Type</a></li>
<li><a href="#org7dbb1c9">cmd for services, clusterip, nodeport, loadbalancer</a></li>
<li><a href="#org8510a4a">yaml file for nginx-with-no-service, service-yaml for clusterip, nodeport, loadbalancer</a>
<ul>
<li><a href="#org969abd9">Nginx-No-service yaml file</a></li>
<li><a href="#orgddb56f7">ClusterIp yaml file</a></li>
<li><a href="#org148a580">NodePort  yaml file</a></li>
<li><a href="#org3396983">LoadBalancer  yaml file</a></li>
<li><a href="#org3cd8c11">Kubernetic cmd</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org89d278e"><span class="timestamp-wrapper"><span class="timestamp">&lt;2021-10-13 Wed 17:16&gt; </span></span> Meeting: Venkat  &lt;Task given:Kubernetics Demonset&gt;</a></li>
<li><a href="#org2e98e01"><span class="timestamp-wrapper"><span class="timestamp">&lt;2021-10-15 Fri 16:48&gt; </span></span> Meeting with  Venkat &lt;Deploy Dev Env digiassessapi in kubernetics&gt;</a>
<ul>
<li><a href="#org8edb972">Report</a></li>
<li><a href="#org5b06e48">Intro</a></li>
</ul>
</li>
<li><a href="#orgeff57ff"><span class="timestamp-wrapper"><span class="timestamp">&lt;2021-10-16 Sat 18:34&gt; </span></span> Troubleshoot in deploying dev-digiassess</a></li>
<li><a href="#org3b61916"><span class="timestamp-wrapper"><span class="timestamp">&lt;2021-10-19 Tue 13:20&gt; </span></span> Douths need to ask venkat</a></li>
<li><a href="#org37a5d10">convert compose to kube yaml using online</a></li>
<li><a href="#org1edfe62"><span class="timestamp-wrapper"><span class="timestamp">&lt;2021-10-21 Thu 18:21&gt; </span></span> Meeting</a></li>
<li><a href="#org08d3038"><span class="timestamp-wrapper"><span class="timestamp">&lt;2021-10-25 Mon 16:18&gt;</span></span></a></li>
</ul>
</div>
</div>
<div id="outline-container-org169a6a8" class="outline-2">
<h2 id="org169a6a8">############ Udemy ############</h2>
</div>
<div id="outline-container-org82c4185" class="outline-2">
<h2 id="org82c4185">k8 installation</h2>
<div class="outline-text-2" id="text-org82c4185">
</div>
<div id="outline-container-orgcb1ff77" class="outline-3">
<h3 id="orgcb1ff77">Intro</h3>
<div class="outline-text-3" id="text-orgcb1ff77">
<ul class="org-ul">
<li>Kubernetes is a series of container,CLI and configrations</li>
<li>many ways to install, let focus on  easier for learning</li>
<li>Dokcer Destop : Enable in settings
<ul class="org-ul">
<li>Sets up everything inside Docker's existing Linxu Vm</li>
</ul></li>
<li>Docker Toolbox on Windows: miniKube
<ul class="org-ul">
<li>Use VirtualBox to make Linux Vm</li>
</ul></li>
<li>Your Own Linux Host or Vm : microk8's
<ul class="org-ul">
<li>Install Kubernetes right on the  OS</li>
</ul></li>
<li>Kubernetes in a browser
<a href="https:katakoda.com">https:katakoda.com</a>
<a href="https:play-with-k8.com">https:play-with-k8.com</a></li>
</ul>
</div>
</div>
<div id="outline-container-org37c0ec0" class="outline-3">
<h3 id="org37c0ec0">Kubernetics Ubuntu installation</h3>
<div class="outline-text-3" id="text-org37c0ec0">
<p>
Open source contaner managment and orchestration
</p>

<p>
Step1 : install docker for kubernetics in both master and slave
<a href="https://kubernetes.io/docs/setup/production-environment/container-runtimes/">https://kubernetes.io/docs/setup/production-environment/container-runtimes/</a>
</p>

<p>
Step 2 : install kubelet kubeadm kubectl in both master and slave
<a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/">https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/</a>
</p>

<p>
Installing kubeadm, kubelet and kubectl
</p>

<ul class="org-ul">
<li>kubeadm: the command to <b>bootstrap the cluster</b>.</li>
<li>kubelet: the component that runs on all of the machines in your cluster and does things like <b>starting pods and containers</b>.</li>
<li>kubectl: the command line util to <b>talk to your cluster</b>.</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">sudo apt-get update &amp;&amp; sudo apt-get install -y apt-transport-https curl
curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add -
cat &lt;&lt;EOF | sudo tee /etc/apt/sources.list.d/kubernetes.list
deb https://apt.kubernetes.io/ kubernetes-xenial main
EOF
sudo apt-get update
sudo apt-get install -y kubelet kubeadm kubectl
sudo apt-mark hold kubelet kubeadm kubectl
</pre>
</div>




<div class="org-src-container">
<pre class="src src-sh">#Create a cluster in master
kubeadmin init #&lt;args&gt;

# https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/

# To start using cluster , you need to run the following  as regular user

# # mkdir -p $HOmE/.kube
# # sudo cp -i /etc/kubenetes/admin.conf $HOmE/.kube/config
# # sudo chown $(id -u): $(id -g) $HOmE/.kube/config

# You should now deploy a pod network to the cluster.
# Run "kubectl apply -f [podnetwork].yaml"  with one of  optional  listed at:
   #  ..
# Then you can join any number of worker nodese by running the following on each is root:
#kubeadm join 172.31.85.184:6443 --token jba6u7.rjkwcd9diiw33x7u / --discovery-token-ca-cert-hash sha256:077d9b3794d7e3d1f25222f6a21d505d9c13d1aa36d9cfab9751040eb6ab4ed


kubectl get nodes # To show nodes



# In slave linux
kubeadm join 172.31.85.184:6443 --token jba6u7.rjkwcd9diiw33x7u / --discovery-token-ca-cert-hash sha256:077d9b3794d7e3d1f25222f6a21d505d9c13d1aa36d9cfab9751040eb6ab4ed

# This node has join the cluster

kubectl get nodes

</pre>
</div>
</div>
</div>

<div id="outline-container-orge7108a3" class="outline-3">
<h3 id="orge7108a3">Vagrant for Kubernetis step 3 VM using vagrant</h3>
<div class="outline-text-3" id="text-orge7108a3">
<p>
<a href="https://www.youtube.com/watch?v=m5q7JEihdU4&amp;t=26s">https://www.youtube.com/watch?v=m5q7JEihdU4&amp;t=26s</a>
</p>
</div>
</div>
</div>
<div id="outline-container-org684c01c" class="outline-2">
<h2 id="org684c01c">Kuberneteics(K8) Why/What [89]</h2>
<div class="outline-text-2" id="text-org684c01c">
<ul class="org-ul">
<li>Intro 
<ul class="org-ul">
<li>Kuberneteics : popular container orchestrator</li>
<li>Container Orchestration = make many servers act like one</li>
<li>Released by Google in 2015 , maintained by large community</li>
<li>Runs on top of Docker (usually) as  set of API's in containers</li>
<li>Provides API/CLI to manage containers across servers</li>
<li>many clouds provide it for you</li>
<li>many vendor make a "distribution" of it</li>
<li></li>
</ul></li>
</ul>
</div>
<div id="outline-container-org684ba74" class="outline-3">
<h3 id="org684ba74">Kubernetics or Swarm</h3>
<div class="outline-text-3" id="text-org684ba74">
<ul class="org-ul">
<li>Kubernetics and Swarm are both container orchestrators</li>
<li>Both are solid platform with vendor backing</li>
<li>Swarm: Easier to deploy/manage</li>
<li>Kubernetes: more feature and flexibility</li>
<li>What's right for you ? Understand both know  your requirements</li>
</ul>

<p>
Advangatages of Swarm
</p>
<ul class="org-ul">
<li>Comes with Docker, Single vendor container platform</li>
<li>Easiest Orchestration to deploy/mangae youself</li>
<li>Follows 80/20 rule, 20% of features for 80% of use case</li>
<li>Runs anywhere Docker does::
<ul class="org-ul">
<li>local, cloud, datacenter,</li>
<li>ARm, Winodws, 32-bit</li>
</ul></li>
<li>Secure by default</li>
<li>Easier to troubleshoot</li>
</ul>

<p>
Advangates of Kubernetics
</p>
<ul class="org-ul">
<li>Has vendor support</li>
<li>Infrastructure vendor are making  the own distribution</li>
<li>Widest adoption and community</li>
<li>Flexible: Covers widest set of use cases</li>
<li>"Kubernetes first" vendor support</li>
<li>"No one ever got fired for buying IBm"</li>
<li>Picking solution isn't 100% rational</li>
<li>Trendy, will benefit you career</li>
</ul>
</div>
</div>
<div id="outline-container-org0ac8c61" class="outline-3">
<h3 id="org0ac8c61">Architecture Terminology</h3>
<div class="outline-text-3" id="text-org0ac8c61">
<p>
<b>Kubernetes</b>: The whole orchestation system
<b>Kubectl</b>: CLI to configure Kubernetes and manage apps also know as "CUBE CONTROL" offically
<b>Node</b> : Single server in Kubernetes cluster
</p>
<ul class="org-ul">
<li>In each Node we run a Kubernetes agent and other like : 
<ul class="org-ul">
<li><b>Kubelet</b> : Kubernetes agent running on nodes</li>
<li><b>Kube-proxy</b> : to control Node Netwrok
<ul class="org-ul">
<li>for communication between different container and contianers in different nodes</li>
</ul></li>
</ul></li>
</ul>

<p>
<b>Kubelet</b>: Kubernetes agent running on nodes
</p>

<p>
<b>Control Plane</b>: Set of Containers in Each Node that manages the cluster simillar to swarm leader or manager  and also called "master"
</p>
<ul class="org-ul">
<li>Includes cmd to get all pods in control plane <code>kubectl get pods -n kube-system</code>
<ul class="org-ul">
<li><b>etcd</b> : distributed storage system for key-value simillar to raft protocol</li>
<li><b>API server</b>: to talk to cluster/serveices</li>
<li><b>scheduler container</b>: How and where the containers are placed  on the node</li>
<li><b>Controller manger</b>: Over-view or Manage all Node/Container/Cluster using API, to inspect that the order-User give what actually is going on.</li>
<li><b>Core DNS</b> :</li>
<li>More like <b>storage</b>, <b>network</b> &#x2026;.etc</li>
</ul></li>

<li>Some time called   "Kubelet" : Kubernetes agent running  on nodes</li>
</ul>
</div>
</div>

<div id="outline-container-orgfc6bd6a" class="outline-3">
<h3 id="orgfc6bd6a"><span class="todo TODO">TODO</span> insert the image</h3>
</div>

<div id="outline-container-org7ee0063" class="outline-3">
<h3 id="org7ee0063">k8s Container Abstraction:</h3>
<div class="outline-text-3" id="text-org7ee0063">
<ul class="org-ul">
<li><b>Pod</b> : one or more contianers running to-gether  on one Node
<ul class="org-ul">
<li>Basic unit of deployment. Container are awalays  in pods</li>
</ul></li>
<li><b>Controller</b>: For creating/updating pods  and other objects
<ul class="org-ul">
<li>Many Type of Controller
<ul class="org-ul">
<li>{deployment, ReplicaSet, 3rd party (StatefulSet, DamemonSet, Job, CronJob), ..etc}</li>
</ul></li>
</ul></li>
<li><b>Service</b>: Network endpoint to connect to pod</li>
<li><b>Namespace</b>: Filtered group of object in cluster</li>
<li><b>Secrets</b>:</li>
<li><b>ConfigMapgs</b>:</li>
<li><b>More&#x2026;.</b>:</li>
</ul>

<pre class="example">
kubectl version

</pre>
<p>
Run,Create, Apply Kubernetes
</p>
<div class="org-src-container">
<pre class="src src-sh">kubectl run #changing to be only pod creation # simillar to docker run 
kubectl create #creat some resources via CLI or yaml # docker swarm create
kubectl apply #create/update anything via yaml # simillar to stack deploy in docker

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org78c0496" class="outline-2">
<h2 id="org78c0496">Creat 1st Pods</h2>
<div class="outline-text-2" id="text-org78c0496">
<p>
Two ways to deploy pods
</p>
<ul class="org-ul">
<li>container</li>
<li>yaml file</li>
</ul>
<pre class="example">
kuberctl version
# create pod using command-line 
kubectl run my-nginx --image nginx
#
kubectl get pods   # simillar to docker service in swarm(stack)
# get pods only give contaienrs that we created but not the kubernetics own contaienrs to see those contaienr we need to get all(get all pods) 
kubectl get all   
</pre>

<p>
Who pods is created
</p>
<ul class="org-ul">
<li>Inside Node/Master: there is kube running on top of docker</li>
<li>Kubectl creates/cmd to Deployment which manage rolling-updagte, replica-set..etc
<ul class="org-ul">
<li>Deployment creates/cmd to Replica set
<ul class="org-ul">
<li>Replicaset creates Pod</li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org7e01f7b" class="outline-2">
<h2 id="org7e01f7b"><span class="todo TODO">TODO</span> insert image of</h2>
<div class="outline-text-2" id="text-org7e01f7b">
<pre class="example">
kubectl delete deployment my-nginx
</pre>
</div>
</div>
<div id="outline-container-org3d3b5f5" class="outline-2">
<h2 id="org3d3b5f5">Scaling ReplicaSets</h2>
<div class="outline-text-2" id="text-org3d3b5f5">
<pre class="example">
kubectl run my-apache --image httpd
kubectl scale deploy/my-apache --replicas 2 # below line are same cmd 
kubectl scale deployment my-apache --replicas 2 #above cmd is same as cmd
</pre>

<p>
How scaling is happening :
</p>
<ul class="org-ul">
<li>When up scaling or down scaling is cmd is given then it pass the scaling update to <b>Deployment</b></li>
<li><b>Deployment</b> update to scale=2 to  <b>relicas</b></li>
<li><b>ReplicaSet Controller</b> sets pod count to 2</li>
<li><b>Control Plane</b> assigns <b>node</b> to pod</li>
<li><b>Kubelet</b> sees pod in needed starts container</li>
</ul>
</div>
</div>
<div id="outline-container-org2264a92" class="outline-2">
<h2 id="org2264a92"><span class="todo TODO">TODO</span> insert image  tiff with crop</h2>
</div>
<div id="outline-container-orgd0f57e1" class="outline-2">
<h2 id="orgd0f57e1">Inspecting Deploy</h2>
<div class="outline-text-2" id="text-orgd0f57e1">
<pre class="example">
kubectl get pods # all contianer running 

kubectl logs deploy/my-apache # pull only one container logs 
kubectl logs deploy/my-apache --follow --tail 1

# Combine logs of all pods with my-apache

kubectl logs -l run=my-apache  # it can pull only up to 5 pods

# Info regarding individual pod
kubectl get pods  # get name-id for it used in next cmd's
kubectl describe pod/my-apache-54dc6c7  # simillar to docker inspect

# Deleting a pod # simillar to deleting container in swarm/stack
  # It will re-create the pod
kubectl get pods -w #in one-window
kubectl delete pod/my-apache-54dc6c7

# rechech current pods
kubectl get pods

</pre>
</div>
</div>
<div id="outline-container-orgb8496e5" class="outline-2">
<h2 id="orgb8496e5">Services (Network )</h2>
<div class="outline-text-2" id="text-orgb8496e5">
<p>
Exposing Containers
</p>
<ul class="org-ul">
<li>kubectl expose crates a service</li>
<li>service is a stable address for pods</li>
<li>If we want to connect to pods we need services</li>
<li>CoreDNS allows us to reslove service by name</li>
</ul>

<p>
Basic Service Types:
</p>
<ul class="org-ul">
<li><b>ClusterIP</b> (default)(has it own DNS )
<ul class="org-ul">
<li>Single, interval virtual IP allocated</li>
<li>Only reachable from within clusteter (node, pods)</li>
<li>Pods can reach service on apps port number</li>
</ul></li>

<li><b>NodePort</b> (Desinged to outside the cluster )
<ul class="org-ul">
<li>High port allocated(assigned) on each node</li>
<li>Port is open on every node's Ip</li>
<li>Anyone can connect (if they can reach node)</li>
<li>Other pods need to be updated to this port</li>
<li>These services are always avaiable in kubernetes</li>
</ul></li>

<li><b>LoadBlancer</b>: (you are controlling a exteranl loadblancer(aws,gcp,azure) through kuber-cmd)
<ul class="org-ul">
<li>Controls a LoadBlancer end point external to the cluster</li>
<li>Only avaiable when infra provider given you a Loadblancer</li>
<li>Creates <b>NodePort</b> + <b>CluserIp</b> Services, tell LB to send to NodePort</li>
</ul></li>

<li><b>ExternalName</b>:
<ul class="org-ul">
<li>Add CNAME DNS record to CoreDNS only</li>
<li>Not used for Pods,but for giving pods a DNS name to use for something outside Kubenetes</li>
</ul></li>
<li><b>Kubenetes Ingress</b> (mostly used for http,https):
<ul class="org-ul">
<li>http/s traffic</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-org4c229a4" class="outline-2">
<h2 id="org4c229a4">Create a ClusterIP</h2>
<div class="outline-text-2" id="text-org4c229a4">
<pre class="example">
kubectl get pods -w # in one-buffer(bin, winodw

# in other winodw run following cmd 
kubectl create deploy/http-env  --image=bretfisher/httpenv
# scale 5
kbuectl scale deploy/http-env --replicas=5

# Create ClusterIP Service
kubectl expose deploy/http-env --port 8888

# get ClusterIP
kubectl get service

# inspect ClusterIP:
</pre>

<div class="org-src-container">
<pre class="src src-sh">kubectl run --generator run-pod/v1 tmp-shell --rm -it --image bretfisher/netshoot --bash
#inside contianer
curl httpenv:8888

kubectl get service  # ip-address
#NAME             TYPE           CLUSTER-IP     EXTERNAL-IP       PORT(S)            AGE
#httpenv          ClusterIP      10.110.159.59  &lt;none&gt;            8888/TCP           7m10s
#nginx-service    ClusterIP      10.96.0.1      &lt;none&gt;            80/TCP             7m10s
#kubernetes       ClusterIP      10.110.159.59  &lt;none&gt;            443/TCP            23d
curl [ip of service]:8888  # work only on linux host 

</pre>
</div>
</div>
</div>
<div id="outline-container-orgc009931" class="outline-2">
<h2 id="orgc009931">Create NodePort and Loadbalancer service</h2>
<div class="outline-text-2" id="text-orgc009931">
<div class="org-src-container">
<pre class="src src-sh">kubectl run --generator run-pod/v1 tmp-shell --rm -it --image bretfisher/netshoot --bash
kubectl get all 


kubectl expose deployment/nginx --port 80 --name service-lb --type LoadBalancer

kubectl get service  # you can see it create cluserip, NodePort and also loadbalancer

#delete pods
kubectl delete service/httpenv service/httpenv-np
kubectl delete service/httpenv-lb deployment/httpenv-np

</pre>
</div>
</div>
</div>
<div id="outline-container-org51d908f" class="outline-2">
<h2 id="org51d908f">Core DNS:</h2>
<div class="outline-text-2" id="text-org51d908f">
<p>
Like Swarm, this is DNS-Based Service Discovery
So far we've been using hostname to access service
<code>curl &lt;hostname&gt;</code>
But that only work for Services in  the same Namespace
<code>kubectl get namespaces</code>
Services also have a FQDN
<code>curl &lt;hostname&gt;.&lt;naemspace&gt;.svc.cluster.local</code>
</p>
<pre class="example">
curl &lt;hostname&gt;
kubectl get namespace
</pre>
</div>
</div>

<div id="outline-container-org2d315c4" class="outline-2">
<h2 id="org2d315c4">Kubernetes Managment Techniques</h2>
<div class="outline-text-2" id="text-org2d315c4">
<p>
Kubectl Generators
The Future of Kubectl Run
Imperatice vs. Declartive
Three Management Approaches
</p>
</div>
</div>

<div id="outline-container-org84f264e" class="outline-2">
<h2 id="org84f264e">Run Expose create Generateor &lt;kube cmd's&gt;</h2>
<div class="outline-text-2" id="text-org84f264e">
<p>
These commands use helper tempaltes called "generator"
Every resources in Kubernetes has a specification or "spec"
<code>kubectl create deployment sample  --image nginx --dry-run -o yaml</code>
You can output those templates with <code>--dry-run -o yaml</code>
You can use those yaml defaults as a starting point
Generator are "opinionated defaults"
</p>
</div>

<div id="outline-container-org0725d02" class="outline-3">
<h3 id="org0725d02">Generator Example</h3>
<div class="outline-text-3" id="text-org0725d02">
<pre class="example">
kubectl create deployment sample  --image nginx --dry-run
kubectl create deployment sample  --image nginx --dry-run -o yaml
#create or generat a yaml file 
kubectl create job test --image nginx --dry-run -o yaml  # create a pods which run only once's it will not restart it again
#Simillary cron job

kubectl expose deployment/test --port 80 --dry-run -o yaml
# create yaml file


kubectl create deployment test --image nginx
</pre>
</div>
</div>
</div>

<div id="outline-container-org79f2b0e" class="outline-2">
<h2 id="org79f2b0e">Future of kubectl run</h2>
</div>
<div id="outline-container-org759575d" class="outline-2">
<h2 id="org759575d">Imperative vs Declarive</h2>
<div class="outline-text-2" id="text-org759575d">
<p>
Imperatice: Focus of how a program operates
Declarative: Focus on what a program should accomplish
</p>

<p>
Kuberentes Imperative:
<code>kubectl run, kubbectl create deployment, kubectl update</code>
</p>
<ul class="org-ul">
<li>We start with a state we know (no delpyment exists)</li>
<li>We ask kubectl run to create a deployment</li>
</ul>
<ul class="org-ul">
<li>Different commands are requried to change that deployment</li>
<li>Different commands are requried per object</li>
</ul>
<p>
Imperative is easier when you know that state
Imperative is easier for humans at a CLI
Imperative is NOT easy to automate
</p>

<p>
Declarative:
<code>kubectl apply -f my-resources.yml</code>
</p>
<ul class="org-ul">
<li>We don't know that current state</li>
<li>We only know what we want the end resutl to be (yaml contents)</li>
<li>Same command each time (tiny exception for delete)</li>
<li>Resources can be all in a file , or many files(apply a whole dir)</li>
<li>Requires understanding the yaml keys and value</li>
<li>More work than kubectl run  for just starting a pod</li>
<li>The easiset way to automate ( <b>gitops</b> every time to want to change edit yml and and git-commit and deploy)</li>
</ul>
</div>

<div id="outline-container-org9d9d503" class="outline-3">
<h3 id="org9d9d503">Three Management Approaches</h3>
<div class="outline-text-3" id="text-org9d9d503">
<ul class="org-ul">
<li>Imperative cmd :
<code>run, expose, scale, edit, create deployment</code>
<ul class="org-ul">
<li>Best for dev/ learing/personal project</li>
<li>Easy to learn, hardest to mange over-time</li>
</ul></li>
<li>Imperative objects:
<code>create -f file.yml, replica -f file.yml, delete</code>    
<ul class="org-ul">
<li>Good for prod of small environments, single file per command</li>
<li>Store your changes in git-based yaml files</li>
<li>Hard to automate</li>
</ul></li>
<li>Declarative objects:
<code>apply -f file.yml</code> or <code>dir\, diff</code>
<ul class="org-ul">
<li>Best for prod, easier to autoamate</li>
<li>Harder to understand and predict changes</li>
</ul></li>
</ul>




<pre class="example">

</pre>
</div>
</div>
</div>
<div id="outline-container-org89181d3" class="outline-2">
<h2 id="org89181d3">Section</h2>
<div class="outline-text-2" id="text-org89181d3">
<ul class="org-ul">
<li>Kubectl apply</li>
<li>yaml</li>
<li>build your yaml files</li>
<li>build you yaml spec</li>
<li>dry runs and diffs</li>
<li>labels and annoatations</li>
</ul>
</div>
</div>

<div id="outline-container-orgcc07020" class="outline-2">
<h2 id="orgcc07020">Kubectl apply</h2>
<div class="outline-text-2" id="text-orgcc07020">
<p>
<code>kubectl appy -f filename.yml</code> simillar to docker stack deploy
</p>

<p>
using kubectl apply
</p>
<ul class="org-ul">
<li>create/update resources in a file
<code>kubectl apply -f myfile.yaml</code></li>
<li>create/update a whole directlry of yaml
<code>kubectl apply -f dir-yaml/</code></li>
<li>create/update form a url
<code>kubectl apply -f https://bret.run/pod.yml</code></li>
</ul>
</div>
</div>
<div id="outline-container-org394bab6" class="outline-2">
<h2 id="org394bab6">Configure yaml</h2>
<div class="outline-text-2" id="text-org394bab6">
<ul class="org-ul">
<li>Kubernetes configuration file (yaml or json )</li>
<li>Each file contians one or more manifests</li>
<li>Each manifiest describes an API object (deployment, job, secret)</li>
<li>Each manifiest needs four parts (root key: value in the file )
<ul class="org-ul">
<li><code>apiVersion</code>:v1, apps/v1</li>
<li><code>kind</code>:Pod, Job, Deployment, Service</li>
<li><code>metadata</code>:
<ul class="org-ul">
<li><code>name</code> : name of pod</li>
</ul></li>
<li><code>spec</code>:
<ul class="org-ul">
<li><code>selector</code></li>
<li><code>replicas</code></li>
<li><code>template</code></li>
<li><code>spec</code>
<ul class="org-ul">
<li><code>container</code>
<ul class="org-ul">
<li><code>name</code>:</li>
<li><code>image</code>:</li>
<li><code>ports</code>:
<ul class="org-ul">
<li><code>contianerPort</code>:</li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-orge1f793c" class="outline-2">
<h2 id="orge1f793c">Build your yaml file</h2>
<div class="outline-text-2" id="text-orge1f793c">
<ul class="org-ul">
<li>kind</li>
</ul>
</div>
</div>
<div id="outline-container-org88c7876" class="outline-2">
<h2 id="org88c7876"><span class="todo TODO">TODO</span> video 106 from udemy</h2>
</div>
<div id="outline-container-org5d417f5" class="outline-2">
<h2 id="org5d417f5"><span class="timestamp-wrapper"><span class="timestamp">&lt;2021-10-06 Wed 09:11&gt; </span></span> Meeting: Abhutahir and Venkat &lt;Install and configure kubernetecis&gt;</h2>
<div class="outline-text-2" id="text-org5d417f5">
<p>
Timeline : Next week deathline dev env should be  in kubernetics
</p>

<p>
source : <a href="https://blog.knoldus.com/how-to-install-kubernetes-on-ubuntu-20-04-kubeadm-and-minikube/">https://blog.knoldus.com/how-to-install-kubernetes-on-ubuntu-20-04-kubeadm-and-minikube/</a>
aunch two ec2-intance (master and slave)
os           : ubutnu 20.04 (18.06)
instance-type:t2.medium
security group:  &lt;created new security group&gt;  kuberentes
need to open some ports in <b>inbound</b> : as given below
<a href="https://kubernetes.io/docs/reference/ports-and-protocols/">https://kubernetes.io/docs/reference/ports-and-protocols/</a>
Install Docker
</p>
<div class="org-src-container">
<pre class="src src-sh">sudo apt update
sudo apt install docker.io
sudo systemctl start docker
sudo systemctl enable docker
</pre>
</div>

<pre class="example">
sudo apt-get update
sudo apt-get install -y apt-transport-https ca-certificates curl gnupg lsb-release

curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg

echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \
  $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null


apt-cache policy docker-ce

sudo apt-get update
sudo apt-get install docker-ce docker-ce-cli containerd.io

</pre>
<p>
Install Kubernetes
</p>
<pre class="example">
sudo curl -fsSLo /usr/share/keyrings/kubernetes-archive-keyring.gpg https://packages.cloud.google.com/apt/doc/apt-key.gpg
echo "deb [signed-by=/usr/share/keyrings/kubernetes-archive-keyring.gpg] https://apt.kubernetes.io/ kubernetes-xenial main" | sudo tee /etc/apt/sources.list.d/kubernetes.list



sudo apt-get update
sudo apt-get install -y kubelet kubeadm kubectl
sudo apt-mark hold kubelet kubeadm kubectl
</pre>


<p>
Disable Swap Memory
</p>
<div class="org-src-container">
<pre class="src src-sh">sudo swapoff -a
sudo nano /etc/fstab
# Inside this file, comment out the /swapfile line.
</pre>
</div>
<p>
swap off
</p>
<div class="org-src-container">
<pre class="src src-sh">sed -i '/ swap / s/^/#/' /etc/fstab
</pre>
</div>



<p>
configure docker
</p>

<p>
cd etc/docker
</p>
<div class="org-src-container">
<pre class="src src-sh">cat &lt;&lt;EOF | sudo tee /etc/modules-load.d/k8s.conf
br_netfilter
EOF

cat &lt;&lt;EOF | sudo tee /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
EOF

cat &lt;&lt;EOF | sudo tee /etc/docker/daemon.json
{
"exec-opts": ["native.cgroupdriver=systemd"],
"log-driver": "json-file",
"log-opts": {
"max-size": "100m"
},
"storage-driver": "overlay2"
}
EOF

systemctl daemon-reload
systemctl restart docker
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">sudo grubby --update-kernel=ALL  --args=‚Äùsystemd.unified_cgroup_hierarchy=1"
#https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#configure-cgroup-driver-used-by-kubelet-on-control-plane-node
cat &lt;&lt;EOF | sudo tee /etc/modules-load.d/k8s.conf
br_netfilter
EOF

cat &lt;&lt;EOF | sudo tee /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
EOF
sudo sysctl --system

cat &lt;&lt;EOF | sudo tee /etc/modules-load.d/containerd.conf
overlay
br_netfilter
EOF

sudo modprobe overlay
sudo modprobe br_netfilter

# Setup required sysctl params, these persist across reboots.
cat &lt;&lt;EOF | sudo tee /etc/sysctl.d/99-kubernetes-cri.conf
net.bridge.bridge-nf-call-iptables  = 1
net.ipv4.ip_forward                 = 1
net.bridge.bridge-nf-call-ip6tables = 1
EOF

# Apply sysctl params without reboot
sudo sysctl --system


sudo mkdir -p /etc/containerd
containerd config default | sudo tee /etc/containerd/config.toml


sudo mkdir /etc/docker
cat &lt;&lt;EOF | sudo tee /etc/docker/daemon.json
{
  "exec-opts": ["native.cgroupdriver=systemd"],
  "log-driver": "json-file",
  "log-opts": {
    "max-size": "100m"
  },
  "storage-driver": "overlay2"
}
EOF
</pre>
</div>
<p>
Set hostnames
</p>
<div class="org-src-container">
<pre class="src src-sh">#kubernetes-master:~$
sudo hostnamectl set-hostname kubernetes-master
sudo hostnamectl set-hostname kubernetes-worker-1
</pre>
</div>
<p>
On Master:
Initialize the cluster (Execute the following command only on the Master node):
</p>
<div class="org-src-container">
<pre class="src src-sh"># https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#configure-cgroup-driver-used-by-kubelet-on-control-plane-node

#kubernetes-master:~$
kubeadm init --pod-network-cidr=172.31.33.101/16

</pre>
</div>
<div class="org-src-container">
<pre class="src src-sh">#kubernetes-master:~$
# https://devopscube.com/setup-kubernetes-cluster-kubeadm/
#IPADDR="10.0.0.10"
#NODENAME=$(hostname -s)

#sudo kubeadm init --apiserver-advertise-address=$IPADDR  --apiserver-cert-extra-sans=$IPADDR  --pod-network-cidr=192.168.0.0/16 --node-name $NODENAME --ignore-preflight-errors Swap

# ############################################################################
# kubeadm init --pod-network-cidr=10.244.0.0/16 --apiserver-advertise-address=10.0.0.200
# kubeadm init --pod-network-cidr=10.244.0.0/16
# kubeadm join 172.31.33.101:6443 --token afk1x9.i9p3yed9o4iytj1j \
#	--discovery-token-ca-cert-hash sha256:58d80548674968fa47f1df47507df983b9af815a3c7405da5654df3ba39825a6
# kubectl get po --all-namespaces

</pre>
</div>
<p>
Set up local kubeconfig(Execute the following command only on the Master node):
</p>
<div class="org-src-container">
<pre class="src src-sh">#kubernetes-master:~$
mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config
#Alternatively, if you are the root user, you can run:
#export KUBECONFIG=/etc/kubernetes/admin.conf
# #############################3
# kubeadm reset --force
# ###########################
# this cmd is used to reset all the configuration
</pre>
</div>
<p>
Apply Flannel CNI network overlay(Execute the following command only on the Master node):
Deploy a pod network
</p>
<div class="org-src-container">
<pre class="src src-sh">#kubernetes-master:~$
kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml
kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/k8s-manifests/kube-flannel-rbac.yml
#kubectl delete -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml
#kubectl delete -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/k8s-manifests/kube-flannel-rbac.yml
</pre>
</div>
<p>
<b>deployment of core-dns is not working properly need to troubleshoot</b>
You should now deploy a pod network to the cluster.
Run "kubectl apply -f [podnetwork].yaml" with one of the options listed at:
  <a href="https://kubernetes.io/docs/concepts/cluster-administration/addons/">https://kubernetes.io/docs/concepts/cluster-administration/addons/</a>
Then you can join any number of worker nodes by running the following on each as root:
kubectl get po &#x2013;all-namespaces
</p>
<div class="org-src-container">
<pre class="src src-sh">#kubernetes-master:~$
kubectl get nodes
kubectl get pods --all-namespaces
#need save etcd as backup in s3 file(*imp)
#professional : run etcd in seperatea meachien
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc909fcf" class="outline-2">
<h2 id="orgc909fcf">Pull Docker images from GitLab Container Registry in Kubernetes Cluster</h2>
<div class="outline-text-2" id="text-orgc909fcf">
<div class="org-src-container">
<pre class="src src-sh">docker login  registry.gitlab.com/digival/digiassess/digiassessapi -u da-api-deploy-token -p uPciF8yZneXoNTL685c-
# ##### Create a yaml file for gitlab docker repo credencials #################################################
kubectl create secret docker-registry dev-digiassessapi \
 --docker-server=https://registry.gitlab.com/digival/digiassess/digiassessapi \
 --docker-username=da-api-deploy-token \
 --docker-password=uPciF8yZneXoNTL685c- \
 --dry-run=client  --output=yaml &gt; docker-repo-secrets.yaml


# ##### Yaml stores the credencials in encripted form ##################################################################
#cat docker-repo-secrets.yaml
apiVersion: v1
data:
  .dockerconfigjson: eyJhdXRocyI6eyJodHRwczovL3JlZ2lzdHJ5LmdpdGxhYi5jb20vZGlnaXZhbC9kaWdpYXNzZXNzL2RpZ2lhc3Nlc3NhcGkiOnsidXNlcm5hbWUiOiJkYS1hcGktZGVwbG95LXRva2VuIiwicGFzc3dvcmQiOiJ1UGNpRjh5Wm5lWG9OVEw2ODVjIiwiYXV0aCI6IlpHRXRZWEJwTFdSbGNHeHZlUzEwYjJ0bGJqcDFVR05wUmpoNVdtNWxXRzlPVkV3Mk9EVmoifX19
kind: Secret
metadata:
  creationTimestamp: null
  name: dev-digiassessapi
type: kubernetes.io/dockerconfigjson

# ######## Pass gitlab credencials to kuberentecis in encripted form  ###########################################################
#root@kubernetes-master:/home/ubuntu# kubectl apply -f docker-repo-secrets.yaml 
secret/dev-digiassessapi created

# ########## The docker-repo-secrets.yaml is encripted base64 we can decript and see the if credencials are correct.
kubectl get secret dev-digiassessapi --output="jsonpath={.data.\.dockerconfigjson}" | base64 --decode
{"auths":{"https://registry.gitlab.com/digival/digiassess/digiassessapi":{"username":"da-api-deploy-token","password":"uPciF8yZneXoNTL685c-","auth":"ZGEtYXBpLWRlcGxveS10b2tlbjp1UGNpRjh5Wm5lWG9OVEw2ODVjLQ=="}}}

# Tell the deployment or pod to use the gitlab credencials for pulling the image in yaml file 
    spec:
      containers:
      - image: registry.gitlab.com/digival/digiassess/digiassessapi:latest
	imagePullPolicy: Always
	name: api
	resources: {}
      imagePullSecrets:
	- name: dev-digiassessapi
</pre>
</div>
</div>
</div>
<div id="outline-container-org214ab84" class="outline-2">
<h2 id="org214ab84"><span class="timestamp-wrapper"><span class="timestamp">&lt;2021-10-09 Sat 11:14&gt; </span></span> Meeting: abhutahir and venkatesh &lt;Task: 2-week know kubernetics&gt;</h2>
<div class="outline-text-2" id="text-org214ab84">
<hr />
<p>
include digival member :  shiraj,nasrullah,kabeer, abuthahir
venkatesh recommends all developer should learn kuberentes
</p>

<hr />
<p>
TASK : In 2-weeks : devops team will be able to do kubernetics and kubernetics cluster
ENTIRE SETUP : AWS and devops everthing will be perfectly ready by Jan 2022
</p>

<hr />
<p>
if you are in troubleshoot in kubernetis you can contact  
</p>
<ul class="org-ul">
<li>google meet(what-app) with venkatesh
available:
<ul class="org-ul">
<li>week day: 5-7pm</li>
<li>saturday and sunday : availabe all day</li>
</ul></li>
</ul>
<hr />
<p>
Whatever cloud provider(either azure, gcc, aws ) we should able to set our project
oracle :
</p>
<ul class="org-ul">
<li>NEED TO disscussion</li>
<li>orcale has it datacenter in saudi region</li>
</ul>
<hr />
<ul class="org-ul">
<li>elk
kibana: need to go with opensource try to reduce licensing 
automate: move logs to s3 buckets as per existing things ()</li>
</ul>


<hr />




<p>
kubectl run my-nginx &#x2013;image nginx
kubectl get pods   # simillar to docker service in swarm(stack)
kubectl scale deploy/my-apache &#x2013;replicas 2 # below line are same cmd 
kubectl scale deployment my-apache &#x2013;replicas 2 #above cmd is same as cmd
kubectl expose deploy/my-nginx &#x2013;replicas 2 &#x2013;port 80
kubectl run nginx &#x2013;image=nginx &#x2013;replicas=1 &#x2013;port 8080
</p>

<p>
kubectl apply -f <a href="https://k8s.io/examples/application/deployment.yaml">https://k8s.io/examples/application/deployment.yaml</a>
kubectl get deploy
kubectl delete pods my-nginx
kubectl delete pods &#x2013;all
</p>

<p>
kubectl describe pod coredns -n kube-system
</p>
</div>
</div>
<div id="outline-container-orga74f254" class="outline-2">
<h2 id="orga74f254"><span class="timestamp-wrapper"><span class="timestamp">&lt;2021-10-11 Mon 15:03&gt; </span></span> Meeting : abhutahir and google Kushal Kashyap &lt;for gcp and azure tranning&gt;</h2>
<div class="outline-text-2" id="text-orga74f254">
<p>
28 servers
</p>

<p>
For techinal expert
</p>

<p>
sme 
</p>
</div>
</div>
<div id="outline-container-orga83dc5c" class="outline-2">
<h2 id="orga83dc5c"><span class="timestamp-wrapper"><span class="timestamp">&lt;2021-10-11 Mon 15:48&gt; </span></span> Meeting: Venkat &lt;installation of kubenetes&gt;</h2>
<div class="outline-text-2" id="text-orga83dc5c">
<p>
kubeadm join 172.31.42.108:6443 &#x2013;token 5ib8cu.jphlqans40ct3qlj \
	&#x2013;discovery-token-ca-cert-hash sha256:33be393e7b2ec89ba0a66ea7e88c189ec97101383daa3630a96b63e18022fd88 
</p>

<p>
To start using your cluster, you need to run the following as a regular user:
</p>

<p>
mkdir -p $HOME/.kube
sudo cp -i <i>etc/kubernetes/admin.conf $HOME</i>.kube/config
sudo chown \((id -u):\)(id -g) $HOME/.kube/config
</p>

<p>
Alternatively, if you are the root user, you can run:
</p>

<p>
export KUBECONFIG=/etc/kubernetes/admin.conf
</p>

<p>
You should now deploy a pod network to the cluster.
Run "kubectl apply -f [podnetwork].yaml" with one of the options listed at:
  <a href="https://kubernetes.io/docs/concepts/cluster-administration/addons/">https://kubernetes.io/docs/concepts/cluster-administration/addons/</a>
</p>

<p>
Then you can join any number of worker nodes by running the following on each as root:
</p>

<p>
kubeadm join 172.31.37.4:6443 &#x2013;token fgr7e4.kug90e8bjl8muoyy \
	&#x2013;discovery-token-ca-cert-hash sha256:e9874acbad1d23a64824a11b7984e75d7c8b3cb230ec07f885310579d4add748
</p>
</div>
</div>
<div id="outline-container-org078c718" class="outline-2">
<h2 id="org078c718">cmd</h2>
<div class="outline-text-2" id="text-org078c718">
<pre class="example">
# get port of particular pod 
kubectl get pod mongo-75f59d57f4-4nd6q --template='{{(index (index .spec.containers 0).ports 0).containerPort}}{{"\n"}}'
kubectl apply -f https://k8s.io/examples/application/deployment.yaml

kubectl describe pod coredns -n kube-system
kubectl apply -f https://k8s.io/examples/application/deployment.yaml

kubeadm reset --force  # reset the setting 


kubectl delete deployment nginx-deployment
kubectl delete pods my-nginx
kubectl delete pods --all

watch kubectl get pods -n calico-system
kubectl get pods -w # watc
kubectl get deployment -o wide
kubectl logs deployment/nginx 
kubectl logs deployment/nginx --follow --tail 2
kubectl logs -l run=nginx # -l : label


kubectl get all
kubectl get replicaset
kubectl get deploy
kubectl get service
kubectl get pod
kubectl get pods --all-namespaces
kubectl get pods 

</pre>
</div>
</div>

<div id="outline-container-org616e9b8" class="outline-2">
<h2 id="org616e9b8">curl: (7) Failed to connect to localhost port 80: Connection refused</h2>
<div class="outline-text-2" id="text-org616e9b8">
<p>
<a href="https://serverfault.com/questions/670575/failed-to-connect-to-127-0-0-1-port-80">https://serverfault.com/questions/670575/failed-to-connect-to-127-0-0-1-port-80</a>
</p>

<p>
Nothing is blocking port 80. You just have firewall NAT rules which are redirecting connections to that port to other ports, which aren't open.
</p>

<pre class="example">
sudo netstat -tulpn | grep 80
Chain PREROUTING (policy ACCEPT 1 packets, 40 bytes)
pkts bytes target     prot opt in     out     source               destination         
0     0 REDIRECT   tcp  --  eth0   *       0.0.0.0/0            0.0.0.0/0            tcp dpt:80 redir ports 20559
0     0 REDIRECT   tcp  --  eth0   *       0.0.0.0/0            0.0.0.0/0            tcp dpt:443 redir ports 20558

Chain OUTPUT (policy ACCEPT 1043 packets, 65731 bytes)
pkts bytes target     prot opt in     out     source               destination         
0     0 REDIRECT   tcp  --  *      *       0.0.0.0/0            127.0.0.1            tcp dpt:80 redir ports 20559
0     0 REDIRECT   tcp  --  *      *       0.0.0.0/0            127.0.0.1            tcp dpt:443 redir ports 20558

</pre>
</div>
</div>
<div id="outline-container-org28f0337" class="outline-2">
<h2 id="org28f0337"><span class="timestamp-wrapper"><span class="timestamp">&lt;2021-10-12 Tue 17:00&gt; </span></span> Meeting: Venkat  &lt;Kubernetics Serivce-Type&gt;</h2>
<div class="outline-text-2" id="text-org28f0337">
<p>
<a href="https://itnext.io/kubernetes-clusterip-vs-nodeport-vs-loadbalancer-services-and-ingress-an-overview-with-722a07f3cfe1">https://itnext.io/kubernetes-clusterip-vs-nodeport-vs-loadbalancer-services-and-ingress-an-overview-with-722a07f3cfe1</a>
</p>
</div>
<div id="outline-container-org030f1a4" class="outline-3">
<h3 id="org030f1a4">Intro to Service-Type</h3>
<div class="outline-text-3" id="text-org030f1a4">
<p>
Kubernetes offers several options when exposing your service based on a feature called Kubernetes Service-types and they are:
</p>
<ul class="org-ul">
<li><b>NodePort</b> (30000-32767):
<ul class="org-ul">
<li>This is the most basic option of exposing your service to be accessible outside of your cluster, on a specific port (called the NodePort) on every node in the cluster. We will illustrate this option shortly.</li>
</ul></li>
<li><b>ClusterIP</b> : 
<ul class="org-ul">
<li>This Service-type generally exposes the service on an internal IP, reachable only within the cluster, and possibly only within the cluster-nodes.</li>
</ul></li>
<li><b>LoadBalancer</b> 
<ul class="org-ul">
<li>This option leverages on external Load-Balancing services offered by various providers to allow access to your service. This is a more reliable option when thinking about high availability for your service, and has more feature beyond default access.</li>
</ul></li>
<li><b>ExternalName</b> 
<ul class="org-ul">
<li>This service does traffic redirect to services outside of the cluster. As such the service is thus mapped to a DNS name that could be hosted out of your cluster. It is important to note that this does not use proxying.</li>
</ul></li>
<li><b>Ingress</b>
<ul class="org-ul">
<li>Actually, the Ingress isn't a dedicated Service - it just describes a set of rules for the Kubernetes Ingress Controller to create a Load Balancer, its Listeners and routing rules for them.</li>
<li>Generally used for http,https</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-org7dbb1c9" class="outline-3">
<h3 id="org7dbb1c9">cmd for services, clusterip, nodeport, loadbalancer</h3>
<div class="outline-text-3" id="text-org7dbb1c9">
<div class="org-src-container">
<pre class="src src-sh">kubectl create deployment nginx --image=nginx
kubectl scale deployment nginx --replicas=5


kubectl expose deployment/nginx --port 80 --name service-cip   # Create ClusterIP Service
kubectl expose deployment/nginx --port 80 --name service-np --type NodePort        # Create NodePort Servic
kubectl expose deployment/nginx --port 80 --name service-lb --type LoadBalancer

NAME         TYPE        CLUSTER-IP          EXTERNAL-IP   PORT(S)        AGE
kubernetes   ClusterIP   10.96.0.1           &lt;none&gt;        443/TCP        27h
service-ip   ClusterIP   10.105.107.120      &lt;none&gt;        80/TCP         6m9s
service-np   NodePort    10.100.116.118      &lt;none&gt;        80:32463/TCP   2m35s
service-lb   LoadBalancer   10.106.169.117   &lt;pending&gt;     80:30556/TCP   7s

# For ClusterIP
curl 10.105.107.120:80 
#&lt;!DOCTYPE html&gt;
#&lt;html&gt;
#&lt;head&gt;
#&lt;title&gt;Welcome to nginx!&lt;/title&gt;
#&lt;style&gt;
#html { color-scheme: light dark; }
#body { width: 35em; margin: 0 auto;
#font-family: Tahoma, Verdana, Arial, sans-serif; }
#&lt;/style&gt;
#&lt;/head&gt;
#&lt;body&gt;
#&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;
#&lt;p&gt;If you see this page, the nginx web server is successfully installed and
#working. Further configuration is required.&lt;/p&gt;
#&lt;p&gt;For online documentation and support please refer to
#&lt;a href="http://nginx.org/"&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;
#Commercial support is available at
#&lt;a href="http://nginx.com/"&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;
#&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;
#&lt;/body&gt;
#&lt;/html&gt;

# For NodePort
firefox public_ip:NodePort 
#firefox http://13.232.106.187:32453
curl 10.100.116.118:32453

firefox public_ip:Loadbalancer_port 
#firefox http://13.232.106.187:30556 

kubectl delete services service-ip service-np service-lb
kubectl delete deploy/nginx
</pre>
</div>
</div>
</div>
<div id="outline-container-org8510a4a" class="outline-3">
<h3 id="org8510a4a">yaml file for nginx-with-no-service, service-yaml for clusterip, nodeport, loadbalancer</h3>
<div class="outline-text-3" id="text-org8510a4a">
</div>
<div id="outline-container-org969abd9" class="outline-4">
<h4 id="org969abd9">Nginx-No-service yaml file</h4>
<div class="outline-text-4" id="text-org969abd9">
<div class="org-src-container">
<pre class="src src-yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
spec:
  selector:
    matchLabels:
      app: nginx
  replicas: 2 # tells deployment to run 2 pods matching the template
  template:
    metadata:
      labels:
	app: nginx
    spec:
      containers:
      - name: nginx
	image: nginx:1.14.2
	ports:
	- containerPort: 80   # target port
</pre>
</div>
</div>
</div>
<div id="outline-container-orgddb56f7" class="outline-4">
<h4 id="orgddb56f7">ClusterIp yaml file</h4>
<div class="outline-text-4" id="text-orgddb56f7">
<div class="org-src-container">
<pre class="src src-yaml">apiVersion: v1
kind: Service
metadata:
  name: "nginx-service"
  namespace: "default"
spec:
  ports:
    - port: 80
  type: ClusterIP
  selector:
    app: "nginx"
</pre>
</div>
</div>
</div>
<div id="outline-container-org148a580" class="outline-4">
<h4 id="org148a580">NodePort  yaml file</h4>
<div class="outline-text-4" id="text-org148a580">
<pre class="example">
apiVersion: v1
kind: Service
metadata:
  name: "nginx-service"
  namespace: "default"
spec:
  ports:
    - port: 80
      nodePort: 30001
  type: NodePort
  selector:
    app: "nginx"
</pre>
</div>
</div>

<div id="outline-container-org3396983" class="outline-4">
<h4 id="org3396983">LoadBalancer  yaml file</h4>
<div class="outline-text-4" id="text-org3396983">
<pre class="example">
apiVersion: v1
kind: Service
metadata:
  name: "nginx-service"
  namespace: "default"
spec:
  ports:
    - port: 80
  type: LoadBalancer
  selector:
    app: "nginx"
</pre>
</div>
</div>

<div id="outline-container-org3cd8c11" class="outline-4">
<h4 id="org3cd8c11">Kubernetic cmd</h4>
<div class="outline-text-4" id="text-org3cd8c11">
<div class="org-src-container">
<pre class="src src-sh">kubectl appy -f nginx-no-service.yaml
kubectl apply -f nginx-LoadBalancer.yaml
kubectl apply -f nginx-ClusterIP.yaml 
kubectl apply -f nginx-NodePort.yml 

kubectl get services
#NAME         TYPE        CLUSTER-IP          EXTERNAL-IP   PORT(S)        AGE
#kubernetes   ClusterIP   10.96.0.1           &lt;none&gt;        443/TCP        27h
#service-ip   ClusterIP   10.105.107.120      &lt;none&gt;        80/TCP         6m9s
#service-np   NodePort    10.100.116.118      &lt;none&gt;        80:32463/TCP   2m35s
#service-lb   LoadBalancer   10.106.169.117   &lt;pending&gt;     80:30556/TCP   7s

kubectl delete -f nginx-NodePort.yml 


</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-org89d278e" class="outline-2">
<h2 id="org89d278e"><span class="timestamp-wrapper"><span class="timestamp">&lt;2021-10-13 Wed 17:16&gt; </span></span> Meeting: Venkat  &lt;Task given:Kubernetics Demonset&gt;</h2>
<div class="outline-text-2" id="text-org89d278e">
<p>
task nginx should run on 32,000
add slave kubernetics
#join 
run nginx as <b>demonset</b>: nginx should run on both(complusory ) slave 
</p>

<p>
abubaker@existing project 
helm chart
promotes and grafana 
secretes
auto-scale pods
</p>
</div>
</div>
<div id="outline-container-org2e98e01" class="outline-2">
<h2 id="org2e98e01"><span class="timestamp-wrapper"><span class="timestamp">&lt;2021-10-15 Fri 16:48&gt; </span></span> Meeting with  Venkat &lt;Deploy Dev Env digiassessapi in kubernetics&gt;</h2>
<div class="outline-text-2" id="text-org2e98e01">
</div>
<div id="outline-container-org8edb972" class="outline-3">
<h3 id="org8edb972">Report</h3>
<div class="outline-text-3" id="text-org8edb972">
<p>
Yestarday i was holiday so during free time i have learned few thing about kubernetecis like
</p>
<ul class="org-ul">
<li>Kubernetic  Architecture:</li>
<li>Master Node 
<ul class="org-ul">
<li>etcd</li>
<li>Controll-Manger 
<ul class="org-ul">
<li>Node-Contorller</li>
<li>Replication-Contorller</li>
<li>Replicaset</li>
</ul></li>
<li>Scheduler</li>
<li>Kube-apiserver</li>
<li>Container-run-time Engine
<ul class="org-ul">
<li>docker</li>
<li>containerd</li>
<li>rocket</li>
</ul></li>
</ul></li>
<li>Worker Node 
<ul class="org-ul">
<li>kubelet</li>
<li>Kube-proxy</li>
</ul></li>
<li>How to write basic kubernetics Yaml file</li>

<li>Kubernetecis pod deployment Architecture : 
<ul class="org-ul">
<li>pod</li>
<li>replication Contorller vs Replicaset</li>
<li>deployment</li>
<li>services</li>
<li>namespaces</li>
</ul></li>
</ul>

<p>
I have completed the task of deploying nginx in using daemonset with nodeport enable 
i have observed that daemonset deploy the nginx to  worker-node but not in master node 
</p>
</div>
</div>

<div id="outline-container-org5b06e48" class="outline-3">
<h3 id="org5b06e48">Intro</h3>
<div class="outline-text-3" id="text-org5b06e48">
<p>
Minutes of Meeting 
</p>

<p>
Try to run kubeclt  only by moving .kube folder and install kubectl 
NOTE: Need to open port both inbound and outbound 64443 
Know how kube-api-server work : 
   eg: kubeclt get pod 
api-server can be a single point of failure because if we are using single master-node and if kube-api-server fails then entire the system work because we lost the communication  or 
kubernetecis is not working or not responding then it is 1st thing as devops engineer is to see
</p>
<ul class="org-ul">
<li>check if kube-api-server is running or not</li>
<li>try to check the logs</li>
<li>kubectl logs &lt;kubeapi-server pod-name&gt; -n kube-system</li>
<li>we need to check logs of coreDNS, scheduler, networking</li>
</ul>

<p>
Deployment file sent by guhan 
</p>
<ul class="org-ul">
<li>ecr registory configure</li>
<li>run the deployment file and add service at node port 32080</li>
</ul>


<p>
kuthen you need to check the log and see where the failure is 
</p>




<p>
Highly Available : 3 master nodes :
</p>
</div>
</div>
</div>
<div id="outline-container-orgeff57ff" class="outline-2">
<h2 id="orgeff57ff"><span class="timestamp-wrapper"><span class="timestamp">&lt;2021-10-16 Sat 18:34&gt; </span></span> Troubleshoot in deploying dev-digiassess</h2>
<div class="outline-text-2" id="text-orgeff57ff">
<p>
<a href="https://medium.com/@damitj07/how-to-configure-and-use-aws-ecr-with-kubernetes-rancher2-0-6144c626d42c">https://medium.com/@damitj07/how-to-configure-and-use-aws-ecr-with-kubernetes-rancher2-0-6144c626d42c</a>
</p>

<p>
<a href="https://medium.com/@stasko.lukasz/how-to-pull-docker-images-from-gitlab-container-registry-in-kubernetes-cluster-aae52787074a">https://medium.com/@stasko.lukasz/how-to-pull-docker-images-from-gitlab-container-registry-in-kubernetes-cluster-aae52787074a</a>
</p>

<p>
<a href="https://jamesdefabia.github.io/docs/user-guide/kubectl/kubectl_create_secret_docker-registry/">https://jamesdefabia.github.io/docs/user-guide/kubectl/kubectl_create_secret_docker-registry/</a>
</p>

<p>
<a href="https://stackoverflow.com/questions/49629241/create-kubernetes-docker-registry-secret-from-yaml-file">https://stackoverflow.com/questions/49629241/create-kubernetes-docker-registry-secret-from-yaml-file</a>
</p>

<pre class="example">
docker login  registry.gitlab.com/digival/digiassess/digiassessapi -u da-api-deploy-token -p uPciF8yZneXoNTL685c-

kubectl get secret dev-digiassessapi --output="jsonpath={.data.\.dockerconfigjson}" | base64 --decode

#cat /root/.docker/config.json 
{
	"auths": {
		"registry.gitlab.com": {
			"auth": "ZGEtYXBpLWRlcGxveS10b2tlbjp1UGNpRjh5Wm5lWG9OVEw2ODVjLQ=="
		}
	}

kubectl create secret docker-registry dev-digiassessapi \
 --docker-server=https://registry.gitlab.com/digival/digiassess/digiassessapi \
 --docker-username=da-api-deploy-token \
 --docker-password=uPciF8yZneXoNTL685c- \
 --dry-run=client  --output=yaml &gt; docker-repo-secrets.yaml


# #######################################################################
apiVersion: v1
data:
  .dockerconfigjson: eyJhdXRocyI6eyJodHRwczovL3JlZ2lzdHJ5LmdpdGxhYi5jb20vZGlnaXZhbC9kaWdpYXNzZXNzL2RpZ2lhc3Nlc3NhcGkiOnsidXNlcm5hbWUiOiJkYS1hcGktZGVwbG95LXRva2VuIiwicGFzc3dvcmQiOiJ1UGNpRjh5Wm5lWG9OVEw2ODVjIiwiYXV0aCI6IlpHRXRZWEJwTFdSbGNHeHZlUzEwYjJ0bGJqcDFVR05wUmpoNVdtNWxXRzlPVkV3Mk9EVmoifX19
kind: Secret
metadata:
  creationTimestamp: null
  name: dev-digiassessapi
type: kubernetes.io/dockerconfigjson

# ###################################################################
#root@kubernetes-master:/home/ubuntu# kubectl apply -f docker-repo-secrets.yaml 
secret/dev-digiassessapi created

# The docker-repo-secrets.yaml is encripted base64 we can decript and see the if credencials are correct.
kubectl get secret dev-digiassessapi --output="jsonpath={.data.\.dockerconfigjson}" | base64 --decode
{"auths":{"https://registry.gitlab.com/digival/digiassess/digiassessapi":{"username":"da-api-deploy-token","password":"uPciF8yZneXoNTL685c-","auth":"ZGEtYXBpLWRlcGxveS10b2tlbjp1UGNpRjh5Wm5lWG9OVEw2ODVjLQ=="}}}


# ##################################################################################
apiVersion: apps/v1
kind: Deployment
metadata:
  ...
spec:
  ...
  template:
    ...
    spec:
      containers:
	- name: image-name
	  image: registry.gitlab.com/namespace/project/image:tag
      imagePullSecrets:
	- name: dev-digiassessapi # &lt;gitlab-auth&gt; or &lt;gitlab-token-auth&gt;

# ##################################################################

# cat docker-repo-secrets.yaml 

apiVersion: v1
data:
  config.json: ewoJImF1dGhzIjogewoJCSJyZWdpc3RyeS5naXRsYWIuY29tIjogewoJCQkiYXV0aCI6ICJaR0V0WVhCcExXUmxjR3h2ZVMxMGIydGxianAxVUdOcFJqaDVXbTVsV0c5T1ZFdzJPRFZqTFE9PSIKCQl9C&gt;
kind: Secret
metadata:
  creationTimestamp: null
  name: regcred
type: kubernetes.io/dockerconfigjson




kubectl create secret docker-registry $SECRET_NAME \
 --docker-server=https://${ACCOUNT}.dkr.ecr.${REGION}.amazonaws.com \
 --docker-username=AWS \
 --docker-password="${TOKEN}" \
 --dry-run=client  --output=yaml &gt; docker-repo-secrets.yaml
# --docker-email="${EMAIL}"
# #######################################################

# ############################################################
kubectl create secret generic regcred \
    --from-file=/root/.docker/config.json \
    --type=kubernetes.io/dockerconfigjson  \
    --dry-run=client  --output=yaml &gt; docker-repo-secrets.yaml

</pre>


<p>
<a href="https://stackoverflow.com/questions/37302776/what-is-the-meaning-of-imagepullbackoff-status-on-a-kubernetes-pod">https://stackoverflow.com/questions/37302776/what-is-the-meaning-of-imagepullbackoff-status-on-a-kubernetes-pod</a>
</p>

<p>
If your repo is private then need to config kuber 
<a href="https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/">https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/</a>
</p>
</div>
</div>
<div id="outline-container-org3b61916" class="outline-2">
<h2 id="org3b61916"><span class="timestamp-wrapper"><span class="timestamp">&lt;2021-10-19 Tue 13:20&gt; </span></span> Douths need to ask venkat</h2>
<div class="outline-text-2" id="text-org3b61916">
<p>
BEST PRACTICE: Not to deploy application on MASTER NODE 
High Availability:  how may minmum ec-2 need to run in kuberentes in HA 
Autoscaling: autoscale the instance ?
Is it possible to move elk and jenkins into kubernetecis ?
</p>
<ul class="org-ul">
<li>elk multi-index</li>
</ul>

<p>
integrate docker-repo with kubernetics 
</p>
</div>
</div>



<div id="outline-container-org37a5d10" class="outline-2">
<h2 id="org37a5d10">convert compose to kube yaml using online</h2>
<div class="outline-text-2" id="text-org37a5d10">
<p>
<a href="https://8gwifi.org/kube1.jsp">https://8gwifi.org/kube1.jsp</a> You can convert your docker compose file to kube.yaml file online
</p>

<div class="org-src-container">
<pre class="src src-sh">docker login registry.gitlab.com/digival/digiauth/digiauthservice -u das-api-deploy-token -p zKH8micASc2D9joWDS_U

kubectl create secret docker-registry docker-login-digiauth \
 --docker-server=https://registry.gitlab.com/digival/digiauth/digiauthservice \
 --docker-username=das-api-deploy-token \
 --docker-password=zKH8micASc2D9joWDS_U \
 --dry-run=client  --output=yaml &gt; docker-digiauth-login.yaml

kubectl apply -f docker-login-digiauth.yaml 

kubectl get secret docker-login-digiauth --output="jsonpath={.data.\.dockerconfigjson}" | base64 --decode

# {"auths":{"https://registry.gitlab.com/digival/digiassess/digiassessapi":{"username":"da-api-deploy-token","password":"uPciF8yZneXoNTL685c-","auth":"ZGEtYXBpLWRlcGxveS10b2tlbjp1UGNpRjh5Wm5lWG9OVEw2ODVjLQ=="}}}

#secret/dev-digiassessapi created

# add below line in deploy or pod definition
      imagePullSecrets:
	- name: digiauth-deploy-gitlab
</pre>
</div>
</div>
</div>
<div id="outline-container-org1edfe62" class="outline-2">
<h2 id="org1edfe62"><span class="timestamp-wrapper"><span class="timestamp">&lt;2021-10-21 Thu 18:21&gt; </span></span> Meeting</h2>
<div class="outline-text-2" id="text-org1edfe62">
<p>
api-6c9bcf899d-tmc8w 
</p>

<p>
docker run &#x2013;
</p>

<p>
docker run -itd &#x2013;name dev-digiassess -p 5000:5000 registry.gitlab.com/digival/digiassess/digiassessapi:latest
</p>
</div>
</div>






<div id="outline-container-org08d3038" class="outline-2">
<h2 id="org08d3038"><span class="timestamp-wrapper"><span class="timestamp">&lt;2021-10-25 Mon 16:18&gt;</span></span></h2>
<div class="outline-text-2" id="text-org08d3038">
<p>
I am facing error node status : "Not Ready"
<a href="https://bobcares.com/blog/kubernetes-cluster-status-of-node-is-notready/">https://bobcares.com/blog/kubernetes-cluster-status-of-node-is-notready/</a>
<a href="https://github.com/kubernetes/kubernetes/issues/68542">https://github.com/kubernetes/kubernetes/issues/68542</a>
<a href="https://stackoverflow.com/questions/47107117/how-to-debug-when-kubernetes-nodes-are-in-not-ready-state">https://stackoverflow.com/questions/47107117/how-to-debug-when-kubernetes-nodes-are-in-not-ready-state</a>
<a href="https://joecreager.com/troubleshooting-kubernetes-worker-node-notready/">https://joecreager.com/troubleshooting-kubernetes-worker-node-notready/</a>
NAME                  STATUS         ROLES                    AGE     VERSION
ip-172-31-13-113      NotReady       &lt;none&gt;                   12d     v1.22.2
ip-172-31-2-133       NotReady       control-plane,master     12d     v1.22.2
kubernetes-worker-2   Ready          &lt;none&gt;                   2d20h   v1.22.2
kubernetes-worker-3   Ready          &lt;none&gt;                   2d      v1.22.2
</p>

<p>
NAME                                                     READY   STATUS        RESTARTS       AGE     IP               NODE                
calico-kube-controllers-75f8f6cc59-lcrgn   1/1     Terminating   0        12d     10.244.82.195    ip-172-31-2-133       
coredns-78fcd69978-8l2cr                         1/1     Terminating   0        12d     10.244.82.194    ip-172-31-2-133       
coredns-78fcd69978-frg2r                         1/1      Terminating   0        12d     10.244.82.193    ip-172-31-2-133      
</p>

<p>
I have inspected the pod and it is showing 
Conditions:
  ContainersReady   True 
  PodScheduled      True
</p>


<p>
aIso i have tried to find solution from google failed but failed
</p>


<hr />

<hr />

<p>
Events:
  Type     Reason       Age                 From               Message
  -&#x2014;     -&#x2013;&#x2014;       -&#x2014;                -&#x2014;               --&#x2013;&#x2014;
  Normal   Scheduled    2m                  default-scheduler  Successfully assigned default/deployment-name27-94d77d477-5hbvm to kubernetes-worker-2
  Warning  FailedMount  58s (x8 over 2m1s)  kubelet            MountVolume.SetUp failed for volume "pvo-0" : hostPath type check failed: assets-built is not a directory
</p>


<p>
<a href="https://stackoverflow.com/questions/65656107/converting-from-docker-compose-to-kubernetes">https://stackoverflow.com/questions/65656107/converting-from-docker-compose-to-kubernetes</a>
</p>


<p>
dev.kubedigiassessapi.digivalsolutions.com
</p>

<p>
eks: 
</p>

<hr />
<p>
kubeadm reset 
rm -rf .kube/
mkdir -p $HOME/.kube
sudo cp -i <i>etc/kubernetes/admin.conf $HOME</i>.kube/config
sudo chown \((id -u):\)(id -g) $HOME/.kube/config
</p>

<hr />

<p>
kubeadm init 
kubeadm join 172.31.2.133:6443 &#x2013;token ury2q3.81mvz1vanjtlnm5u \
	&#x2013;discovery-token-ca-cert-hash sha256:c95a1d6caa10e653d3d123ddbb29eb4ca98c9dde48d74bce8942401578768d69 
</p>



<hr />
<p>
kubeadm reset
kubeadm join 172.31.2.133:6443 &#x2013;token ury2q3.81mvz1vanjtlnm5u \
	&#x2013;discovery-token-ca-cert-hash sha256:c95a1d6caa10e653d3d123ddbb29eb4ca98c9dde48d74bce8942401578768d69 
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Karthik</p>
<p class="date">Created: 2023-03-16 Thu 11:43</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
